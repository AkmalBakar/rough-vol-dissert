# On the Structure of General Mean-Variance Hedging Strategies

**Authors:** Aleš Černý and Jan Kallsen
**Affiliations:** City University London and Technische Universität München
**Journal:** The Annals of Probability, 2007, Vol. 35, No. 4, 1479–1531
**DOI:** 10.1214/009117906000000872

---

## Abstract

We provide a new characterization of mean-variance hedging strategies in a general semimartingale market. The key point is the introduction of a new probability measure $P^\star$ which turns the dynamic asset allocation problem into a myopic one. The minimal martingale measure relative to $P^\star$ coincides with the variance-optimal martingale measure relative to the original probability measure $P$.

**AMS 2000 subject classifications:** 91B28, 60H05, 60G48, 93E20

**Key words and phrases:** Mean-variance hedging, opportunity process, opportunity-neutral measure, incomplete markets.

---

## Contents

1. Introduction
   - 1.1. Overview
   - 1.2. Semimartingale characteristics and notation
2. Admissible strategies and quadratic hedging
   - 2.1. Admissible strategies
   - 2.2. Mean-variance hedging
3. On the pure investment problem
   - 3.1. Opportunity process
   - 3.2. Adjustment process
   - 3.3. Variance-optimal signed martingale measure
   - 3.4. Opportunity-neutral measure
   - 3.5. Characterization of $L$ and $\tilde{a}$
   - 3.6. When does $P^\star = P$ hold?
   - 3.7. Determination of the opportunity process
4. On the quadratic hedging problem
   - 4.1. Mean value process and pure hedge coefficient
   - 4.2. Main results
   - 4.3. Connections to the literature
- Appendix
   - A.1. Locally square-integrable semimartingales
   - A.2. $\sigma$-Martingales
- References

---

## 1. Introduction

### 1.1. Overview

In incomplete market models perfect replication of contingent claims is typically impossible. A classical way out is to minimize the mean squared hedging error

$$E\left((v + \vartheta \bullet S_T - H)^2\right)$$

over all reasonable hedging strategies $\vartheta$ and possibly all initial endowments $v$. Here, the random variable $H$ denotes the discounted payoff of the claim, the semimartingale $S$ stands for the discounted price process of the underlying, the dot refers to stochastic integration, and $T$ is the time horizon. Mathematically speaking, one seeks to compute the orthogonal projection of $H$ on some space of stochastic integrals.

This problem has been extensively studied both as far as general theory as well as concrete results in specific setups are concerned. In order to render equal justice (or rather injustice) to most contributions, we refer the reader to [38] and [45] for excellent overviews of the literature. More recent publications in this context include [2–4, 7–11, 17, 23–26, 32–36, 46].

The purpose of this piece of research is to provide a deeper understanding of the structure of the mean-variance hedging problem in a general semimartingale context. More specifically, we aim at concrete formulas for the objects of interest—to the extent that this is possible without restricting to more specific situations.

If $S$ is a square-integrable martingale, the answer to the above hedging problem is provided by the Galtchouk–Kunita–Watanabe decomposition of the claim (cf. [19]). In particular, the optimal hedge $\vartheta$ is of the form

$$\vartheta_t = \frac{d\langle V, S \rangle_t}{d\langle S, S \rangle_t},$$

where $V_t = E(H|\mathcal{F}_t)$ denotes the martingale generated by the contingent claim $H$.

If $S$ fails to be a martingale, the hedging problem becomes much more involved. Relatively explicit results have been obtained by Schweizer [42] under the condition of deterministic mean-variance tradeoff, which can be interpreted as a certain homogeneity property of the asset price process $S$. In this case the optimal hedge is the sum of two terms. The first satisfies an equation resembling (1.1). The second can be interpreted in terms of a pure investment problem under quadratic utility.

In the current paper we reduce the general case to the expressions of [42]. This is done by a specific nonmartingale change of measure. If the formulas of [42] are evaluated relative to the new **opportunity-neutral measure** $P^\star$ rather than $P$, they yield the optimal hedge relative to the original probability measure $P$. We discuss the links to the literature more thoroughly in Section 4.3.

The paper is structured as follows. Section 2 explains the setup of the mean-variance problem at hand. In particular, we define a notion of admissibility which ensures the existence of an optimal hedge. The measure change alluded to above and related objects are introduced in Section 3. Subsequently, we turn to the hedging problem itself. Finally, the appendix contains and summarizes auxiliary statements on semimartingales. In particular, we prove a sufficient condition for square integrability of exponential semimartingales which is needed in Section 4.

### 1.2. Semimartingale characteristics and notation

Unexplained notation is typically used as in [28]. Superscripts refer generally to coordinates of a vector or vector-valued process rather than powers. The few exceptions should be obvious from the context. If $X$ is a semimartingale, $L(X)$ denotes the set of $X$-integrable predictable processes in the sense of [28], III.6.17.

In the subsequent sections, optimal hedging strategies are expressed in terms of semimartingale characteristics.

**Definition 1.1.** Let $X$ be an $\mathbb{R}^d$-valued semimartingale with characteristics $(B, C, \nu)$ relative to some truncation function $h : \mathbb{R}^d \to \mathbb{R}^d$. By [28], II.2.9 there exists some predictable process $A \in \mathcal{A}^+_{loc}$, some predictable $\mathbb{R}^{d \times d}$-valued process $c$ whose values are nonnegative, symmetric matrices, and some transition kernel $F$ from $(\Omega \times \mathbb{R}_+, \mathcal{P})$ into $(\mathbb{R}^d, \mathcal{B}^d)$ such that

$$B_t = b \bullet A_t, \quad C_t = c \bullet A_t, \quad \nu([0,t] \times G) = F(G) \bullet A_t$$

for $t \in [0, T]$, $G \in \mathcal{B}^d$.

We call $(b, c, F, A)$ **differential characteristics** of $X$.

One should observe that the differential characteristics are not unique: for example, $(2b, 2c, 2F, \frac{1}{2}A)$ yields another version. Especially for $A_t = t$, one can interpret $b_t$ or rather $b_t + \int (x - h(x))F_t(dx)$ as a drift rate, $c_t$ as a diffusion coefficient, and $F_t$ as a local jump measure. The differential characteristics are typically derived from other "local" representations of the process, for example, in terms of a stochastic differential equation.

From now on, we choose the same fixed process $A$ for all the (finitely many) semimartingales in this paper. The results do not depend on its particular choice. In concrete models, $A$ is often taken to be $A_t = t$ (e.g., for Lévy processes, diffusions, Itô processes, etc.) and $A_t = [t] := \max\{n \in \mathbb{N} : n \leq t\}$ (discrete-time processes). Since almost all semimartingales of interest in this paper are actually special semimartingales, we use from now on the (otherwise forbidden) "truncation" function

$$h(x) := x,$$

which simplifies a number of expressions considerably.

By $\langle X, Y \rangle$ we denote the $P$-compensator of $[X, Y]$ provided that $X, Y$ are semimartingales such that $[X, Y]$ is $P$-special (cf. [27], page 37). If $X$ and $Y$ are vector-valued, then $[X, Y]$ and $\langle X, Y \rangle$ are to be understood as matrix-valued processes with components $[X^i, Y^j]$ and $\langle X^i, Y^j \rangle$, respectively. Moreover, if both $Y$ and a predictable process $\vartheta$ are $\mathbb{R}^d$-valued, then the notation $\vartheta \bullet [X, Y]$ (and accordingly $\vartheta \bullet \langle X, Y \rangle$) refers to the vector-valued process whose components $\vartheta \bullet [X^i, Y]$ are the vector-stochastic integral of $(\vartheta^j)_{j=1,\ldots,d}$ relative to $([X^i, Y^j])_{j=1,\ldots,d}$. If $P^\star$ denotes another probability measure, we write $\langle X, Y \rangle^{P^\star}$ for the $P^\star$-compensator of $[X, Y]$.

In the whole paper, we write $M^X$ for the local martingale part and $A^X$ for the predictable part of finite variation in the canonical decomposition

$$X = X_0 + M^X + A^X$$

of a special semimartingale $X$. If $P^\star$ denotes another probability measure, we write accordingly

$$X = X_0 + M^{X^\star} + A^{X^\star}$$

for the $P^\star$-canonical decomposition of $X$.

If $(b, c, F, A)$ denote differential characteristics of an $\mathbb{R}^d$-valued special semimartingale $X$, we use the notation $\tilde{c}, \hat{c}$ for modified second characteristics in the following sense (provided that the integrals exist):

$$\tilde{c} := c + \int xx^\top F(dx),$$

$$\hat{c} := c + \int xx^\top F(dx) - bb^\top \Delta A.$$

Observe that $x^\top \hat{c} x \leq x^\top \tilde{c} x$ for any $x \in \mathbb{R}^d$. The notion of modified second characteristics is motivated by the following:

**Proposition 1.2.** Let $X$ be an $\mathbb{R}^d$-valued special semimartingale with differential characteristics $(b, c, F, A)$ and modified second characteristics as in (1.2) and (1.3). If the corresponding integrals exist, then

$$\langle X, X \rangle = \tilde{c} \bullet A,$$
$$\langle M^X, M^X \rangle = \hat{c} \bullet A.$$

*Proof.* The first equation follows from [28], I.4.52, the second from [28], II.2.17 (adjusted for the truncation function). $\square$

From now on we use the notation $(b^X, c^X, F^X, A)$ to denote differential characteristics of a special semimartingale $X$. Accordingly, $\tilde{c}^X, \hat{c}^X$ stands for the modified second characteristics of $X$. If they refer to some probability measure $P^\star$ rather than $P$, we write instead $(b^{X^\star}, c^{X^\star}, F^{X^\star}, A)$ and $\tilde{c}^{X^\star}, \hat{c}^{X^\star}$, respectively. We denote the joint characteristics of two special semimartingales $X, Y$ [i.e., the characteristics of $(X, Y)$] as

$$(b^{X,Y}, c^{X,Y}, F^{X,Y}, A) = \left(\begin{pmatrix} b^X \\ b^Y \end{pmatrix}, \begin{pmatrix} c^X & c^{XY} \\ c^{YX} & c^Y \end{pmatrix}, F^{X,Y}, A\right)$$

and

$$\tilde{c}^{X,Y} = \begin{pmatrix} \tilde{c}^X & \tilde{c}^{XY} \\ \tilde{c}^{YX} & \tilde{c}^Y \end{pmatrix}, \quad \hat{c}^{X,Y} = \begin{pmatrix} \hat{c}^X & \hat{c}^{XY} \\ \hat{c}^{YX} & \hat{c}^Y \end{pmatrix}.$$

In the whole paper, we write $c^{-1}$ for the Moore–Penrose pseudoinverse of a matrix or matrix-valued process $c$, which is a particular matrix satisfying $cc^{-1}c = c$ (cf. [1]). From the construction it follows that the mapping $c \mapsto c^{-1}$ is measurable. Moreover, $c^{-1}$ is nonnegative and symmetric if this holds for $c$.

Finally, we write $X \sim Y$ (resp. $X \sim^\star Y$) if two semimartingales differ only by some $P$-$\sigma$-martingale (or some $P^\star$-$\sigma$-martingale, resp.). Some facts on $\sigma$-martingales are summarized in Appendix A.2.

---

## 2. Admissible Strategies and Quadratic Hedging

We work on a filtered probability space $(\Omega, \mathcal{F}, (\mathcal{F}_t)_{t \in [0,T]}, P)$, where $T \in \mathbb{R}_+$ denotes a fixed terminal time. The $\mathbb{R}^d$-valued process $S = (S^1_t, \ldots, S^d_t)_{t \in [0,T]}$ represents the discounted prices of $d$ securities. We assume that

$$\sup\{E((S^i_\tau)^2) : \tau \text{ stopping time}, i = 1, \ldots, d\} < \infty,$$

that is, $S$ is a $L^2(P)$-semimartingale in the sense of [15].

Moreover, we make the following standing:

**Assumption 2.1.** There exists some equivalent $\sigma$-martingale measure with square-integrable density, that is, some probability measure $Q \sim P$ with $E\left(\left(\frac{dQ}{dP}\right)^2\right) < \infty$ and such that $S$ is a $Q$-$\sigma$-martingale.

This can be interpreted as a natural no-free-lunch condition in the present quadratic context. More specifically, Théorème 2 in [47] and standard arguments show that Assumption 2.1 is equivalent to the absence of $L^2$-free lunches in the sense that

$$\overline{K^2_s(0) - L^2_+} \cap L^2_+ = \{0\},$$

where $K^2_s(0)$ denotes the set of payoffs of simple trading defined below, $L^2_+$ contains the nonnegative square-integrable random variables, and the closure is to be taken in $L^2(P)$.

### 2.1. Admissible strategies

The choice of the set of admissible trading strategies in continuous time is a delicate point. If it is too large, arbitrage opportunities occur even in the Black–Scholes model, if it is too small, optimal strategies as, for example, the replicating portfolio of a European call in the Black–Scholes model fail to exist. Inspired by Delbaen and Schachermayer [15], we consider the closure (in a proper $L^2$-sense) of the set of simple strategies.

More specifically, an $\mathbb{R}^d$-valued process $\vartheta$ is called **simple** if it is a linear combination of processes of the form $Y \mathbf{1}_{]\!]\tau_1, \tau_2]\!]}$, where $\tau_1 \leq \tau_2$ denote stopping times and $Y$ a bounded $\mathcal{F}_{\tau_1}$-measurable random variable. We call a payoff **attainable by simple trading** with initial endowment $v \in L^2(\Omega, \mathcal{F}_0, P)$ if it belongs to the set

$$K^2_s(v) := \{v + \vartheta \bullet S_T : \vartheta \text{ simple}\}.$$

If the initial endowment $v$ is not fixed beforehand, we consider instead the set

$$K^2_s(\mathcal{F}_0) := \{v + \vartheta \bullet S_T : v \in L^2(\Omega, \mathcal{F}_0, P), \vartheta \text{ simple}\}.$$

Since the hedging problems in this paper concern the approximation of arbitrary payoffs $H$ in $L^2(P)$ by attainable outcomes, it makes perfect sense from an economical point of view to call the elements of the $L^2(P)$-closures $K^2(v) := \overline{K^2_s(v)}$, respectively, $K^2(\mathcal{F}_0) := \overline{K^2_s(\mathcal{F}_0)}$ attainable as well. These outcomes can be written as a stochastic integral $v + \vartheta \bullet S_T$ with some strategy $\vartheta \in L(S)$ that can be approximated in the following sense by simple strategies (cf. Lemmas 2.4 and 2.6 below).

**Definition 2.2.** We call $\vartheta \in L(S)$ **admissible strategy** if there exists some sequence $(\vartheta^{(n)})_{n \in \mathbb{N}}$ of simple strategies such that

$$\vartheta^{(n)} \bullet S_t \to \vartheta \bullet S_t \quad \text{in probability for any } t \in [0, T]$$

and

$$\vartheta^{(n)} \bullet S_T \to \vartheta \bullet S_T \quad \text{in } L^2(P).$$

Similarly, we call $(v, \vartheta) \in L^0(\Omega, \mathcal{F}_0, P) \times L(S)$ **admissible endowment/strategy pair** if there exist some sequences $(v^{(n)})_{n \in \mathbb{N}}$ in $L^2(\Omega, \mathcal{F}_0, P)$ and $(\vartheta^{(n)})_{n \in \mathbb{N}}$ of simple strategies such that

$$v^{(n)} + \vartheta^{(n)} \bullet S_t \to v + \vartheta \bullet S_t \quad \text{in probability for any } t \in [0, T]$$

and

$$v^{(n)} + \vartheta^{(n)} \bullet S_T \to v + \vartheta \bullet S_T \quad \text{in } L^2(P).$$

We set

$$\Theta := \{\vartheta \in L(S) : \vartheta \text{ admissible}\},$$
$$L^2(\mathcal{F}_0) \times \Theta := \{(v, \vartheta) \in L^0(\Omega, \mathcal{F}_0, P) \times L(S) : (v, \vartheta) \text{ admissible}\}.$$

One easily verifies that $L^2(\mathcal{F}_0) \times \Theta = \mathbb{R} \times \Theta$ if the initial $\sigma$-field $\mathcal{F}_0$ is trivial. Admissible strategies are linked via duality to martingale measures of the following kind:

**Definition 2.3.** We call a signed measure $Q \ll P$ with $Q(\Omega) = 1$ **absolutely continuous signed $\sigma$-martingale measure (S$\sigma$MM)** if $SZ^Q$ is a $P$-$\sigma$-martingale for the density process

$$Z^Q_t := E\left(\frac{dQ}{dP} \Big| \mathcal{F}_t\right)$$

of $Q$.

A probability measure $Q \sim P$ is a S$\sigma$MM if and only if $S$ is a $Q$-$\sigma$-martingale (cf. Lemma A.8).

**Lemma 2.4.** For $H \in L^2(P)$ and $v \in L^2(\Omega, \mathcal{F}_0, P)$ the following statements are equivalent:

1. $H \in K^2(v)$.
2. $E_Q(H - v) = 0$ for any S$\sigma$MM $Q$ with $\frac{dQ}{dP} \in L^2(P)$.
3. $H = v + \vartheta \bullet S_T$ with some $\vartheta \in \Theta$.
4. $H = v + \vartheta \bullet S_T$ with some $\vartheta \in L(S)$ such that $(\vartheta \bullet S)Z^Q$ is a martingale for any S$\sigma$MM $Q$ with density process $Z^Q$ and $\frac{dQ}{dP} \in L^2(P)$.

In particular, we have $K^2(v) = \{v + \vartheta \bullet S_T : \vartheta \in \Theta\}$.

### 2.2. Mean-variance hedging

The goal of this paper is to hedge a fixed contingent claim with discounted payoff $H \in L^2(\Omega, \mathcal{F}, P)$. We consider two closely related optimization problems.

**Definition 2.10.**

1. We call an admissible endowment/strategy pair $(v_0, \varphi)$ **optimal** if $(v, \vartheta) = (v_0, \varphi)$ minimizes the expected squared hedging error

$$E\left((v + \vartheta \bullet S_T - H)^2\right)$$

over all admissible endowment/strategy pairs $(v, \vartheta)$.

2. If the initial endowment $v = v_0 \in L^2(\Omega, \mathcal{F}_0, P)$ is given beforehand, a minimizer $\vartheta = \varphi$ of (2.3) over all $\vartheta \in \Theta$ is called **optimal hedging strategy for given initial endowment** $v_0$.

Due to the chosen notion of admissibility, optimal hedges always exist:

**Lemma 2.11.** There exist optimal hedges in the sense of Definition 2.10(1) and (2). In both cases, the value process $v_0 + \varphi \bullet S$ of the optimal hedge is unique up to a $P$-null set.

---

## 3. On the Pure Investment Problem

In many papers the mean-variance hedging problem is partially reduced to pure portfolio optimization with quadratic utility. This is done here as well.

### 3.1. Opportunity process

In the spirit of Markowitz, we call an admissible strategy $\lambda^{(\tau)}$ **efficient on a stochastic interval** $]\!]\tau, T]\!]$ if it minimizes

$$E\left((1 - \vartheta \bullet S_T)^2\right)$$

over all $\vartheta \in \Theta$ vanishing on $[\![0, \tau]\!]$. Indeed, by standard arguments there exists no strategy with at most the same variance yielding a higher expected return. Alternatively, one may view $\lambda^{(\tau)}$ as optimal hedging strategy on $]\!]\tau, T]\!]$ for the constant option $H = 1$. A crucial role will be played by the related **opportunity process**

$$L_t = E\left((1 - \lambda^{(t)} \bullet S_T)^2 | \mathcal{F}_t\right),$$

whose existence and properties are yet to be derived.

**Lemma 3.1.**
1. For any stopping time $\tau$ there exists an efficient strategy $\lambda^{(\tau)}$ on $]\!]\tau, T]\!]$. Its value process $1 - \lambda^{(\tau)} \bullet S$ is uniquely determined.
2. $1 - \lambda^{(\varrho)} \bullet S_\tau = (1 - \lambda^{(\varrho)} \bullet S_\sigma)(1 - \lambda^{(\sigma)} \bullet S_\tau)$ for all stopping times $\varrho \leq \sigma \leq \tau$.
3. If $1 - \lambda^{(\sigma)} \bullet S_\tau = 0$, then $1 - \lambda^{(\sigma)} \bullet S_T = 0$ for all stopping times $\sigma \leq \tau$.
4. $E((1 - \lambda^{(\tau)} \bullet S_T)^2 | \mathcal{F}_\sigma) \leq E((1 - \vartheta \bullet S_T)^2 | \mathcal{F}_\sigma)$ for all stopping times $\sigma \leq \tau$ and any strategy $\vartheta \in \Theta$ with $\vartheta \mathbf{1}_{[\![0,\tau]\!]} = 0$.
5. $E(1 - \lambda^{(\tau)} \bullet S_T | \mathcal{F}_\sigma) = E((1 - \lambda^{(\tau)} \bullet S_T)^2 | \mathcal{F}_\sigma) \in (0, 1]$ almost surely for all stopping times $\sigma \leq \tau$.

**Lemma 3.2.**
1. There exists a unique semimartingale $L$ with $L_T = 1$ such that the process $M^{(\tau)} - (M^{(\tau)})^\tau$ is a martingale for any stopping time $\tau$, where

$$M^{(\tau)} := (1 - \lambda^{(\tau)} \bullet S)L.$$

2. The process $\mathbf{1}_{]\!]\tau,T]\!]} \bullet (SM^{(\tau)})$ is a martingale for any stopping time $\tau$.
3. The process $((v + \vartheta \bullet S_s)M^{(t)}_s)_{s \in [t,T]}$ is a martingale for any $(v, \vartheta) \in L^2(\mathcal{F}_0) \times \Theta$ and any $t \in [0, T]$.

**Definition 3.3.** We call the process $L$ from Lemma 3.2 **opportunity process**.

The terminology is inspired by the fact that $L$ is linked to optimal investment opportunities. Indeed, the following corollary states that $L$ represents both first and second moments of efficient strategies in the sense of (3.1).

**Corollary 3.4.** For any $t \in [0, T]$ we have

$$L_t = E(1 - \lambda^{(t)} \bullet S_T | \mathcal{F}_t)$$
$$= E\left((1 - \lambda^{(t)} \bullet S_T)^2 | \mathcal{F}_t\right)$$
$$= \inf\{E((1 - \vartheta \bullet S_T)^2 | \mathcal{F}_t) : \vartheta \in \Theta \text{ with } \vartheta \mathbf{1}_{[\![0,t]\!]} = 0\}.$$

In particular, $L$ is a submartingale.

These equations can be interpreted in terms of dynamic Sharpe ratios:

**Definition 3.5.** For $t \in [0, T]$ we call

$$\varrho_t := \sup\left\{\frac{E(\vartheta \bullet S_T | \mathcal{F}_t)}{\sqrt{\text{Var}(\vartheta \bullet S_T | \mathcal{F}_t)}} : \vartheta \in \Theta \text{ with } \vartheta \mathbf{1}_{[\![0,t]\!]} = 0\right\}$$

**maximal Sharpe ratio** on $(t, T]$, where we set $\text{Var}(X|\mathcal{F}_t) := E(X^2|\mathcal{F}_t) - (E(X|\mathcal{F}_t))^2$ and $\frac{0}{0} := 0$.

**Proposition 3.6.** The relation between opportunity process $L$ and maximal Sharpe ratio $\varrho$ is given by

$$\varrho = \sqrt{\frac{1}{L} - 1}$$

and

$$L = \frac{1}{1 + \varrho^2},$$

respectively.

### 3.2. Adjustment process

The optimal number of shares $\lambda^{(\tau)}$ in (3.1) depends on $\tau$. However, the optimal number of shares per unit of wealth does not. It is denoted by $\tilde{a}$ in the following lemma.

**Lemma 3.7.** We use the notation from Lemma 3.1. There exists some $\tilde{a} \in L(S)$ such that

$$1 - \lambda^{(\tau)} \bullet S = \mathcal{E}((-\tilde{a}\mathbf{1}_{]\!]\tau,T]\!]}) \bullet S) = 1 - (\tilde{a}\mathbf{1}_{]\!]\tau,T]\!]} \mathcal{E}((-\tilde{a}\mathbf{1}_{]\!]\tau,T]\!]}) \bullet S)_-) \bullet S$$

for any stopping time $\tau$. Consequently, we may assume

$$\lambda^{(\tau)} = \tilde{a}\mathbf{1}_{]\!]\tau,T]\!]} \mathcal{E}((-\tilde{a}\mathbf{1}_{]\!]\tau,T]\!]}) \bullet S)_-.$$

**Definition 3.8.** The (not necessarily unique) process $\tilde{a}$ from Lemma 3.7 is called **adjustment process**. Moreover, we call

$$\hat{a} := (1 + \Delta A^K)\tilde{a}$$

**extended adjustment process**.

**Corollary 3.9.** $E(\vartheta \bullet S_T \mathcal{E}(-\tilde{a} \bullet S)_T) = 0$ for any $\vartheta \in \Theta$, i.e., $\tilde{a}$ is an adjustment process in the sense of [44], Section 3 with $\Theta$ substituted for $\bar{\Theta}$.

**Lemma 3.10.** $L$, $L_-$ are $(0, 1]$-valued.

Since $L_-$ does not vanish, the stochastic logarithm of $L$ is well defined:

**Definition 3.11.** We call

$$K := \mathcal{L}(L) := \frac{1}{L_-} \bullet L$$

**modified mean-variance tradeoff (MMVT) process**.

The modified mean-variance tradeoff process is related to the mean-variance tradeoff (MVT) process of [42] (cf. Section 3.6).

### 3.3. Variance-optimal signed martingale measure

With the help of the modified mean-variance tradeoff process $K$ and the adjustment process $\tilde{a}$ we can define a signed measure $Q^\star$ which plays an important role in the context of quadratic hedging. This variance-optimal signed martingale measure appears more or less explicitly in many papers on the subject.

**Definition 3.12.** We call

$$N := K - \tilde{a} \bullet S - [\tilde{a} \bullet S, K]$$

**variance-optimal logarithm process** and the signed measure $Q^\star$ defined via

$$\frac{dQ^\star}{dP} := \frac{L_0}{E(L_0)}\mathcal{E}(N)_T = \frac{\mathcal{E}(-\tilde{a} \bullet S)_T}{E(L_0)} = \frac{1 - \lambda^{(0)} \bullet S_T}{E(1 - \lambda^{(0)} \bullet S_T)}$$

**variance-optimal signed martingale measure (variance-optimal S$\sigma$MM)**.

The following result explains the terminology.

**Proposition 3.13.**
1. $Q^\star$ is a S$\sigma$MM (cf. Definition 2.3) with density process

$$Z^{Q^\star} := \frac{L_0}{E(L_0)}\mathcal{E}(N) = \frac{L\mathcal{E}(-\tilde{a} \bullet S)}{E(L_0)}.$$

2. $Q^\star$ minimizes $Q \mapsto E\left(\left(\frac{dQ}{dP}\right)^2\right)$ over all S$\sigma$MM's $Q$. Hence it is the variance-optimal signed $\Theta$-martingale measure in the sense of [44], Section 1, with $\bar{\Theta}$ replaced by $\Theta$ in the definition.

**Lemma 3.14.** The variance-optimal logarithm process $N$ and also $S + [S, N]$ are $\sigma$-martingales. Consequently, $S\mathcal{E}(N)$ is a $\sigma$-martingale as well.

### 3.4. Opportunity-neutral measure

In this section we define a measure $P^\star$ in terms of its density process

$$Z^{P^\star} := \frac{L}{E(L_0)\mathcal{E}(A^K)}.$$

For $Z^{P^\star}$ to be truly a density process, we need the following:

**Lemma 3.15.** The process $Z^{P^\star}$ is a bounded positive martingale and satisfies

$$Z^{P^\star} = \frac{L_0}{E(L_0)}\mathcal{E}\left(\frac{1}{1 + \Delta A^K} \bullet M^K\right).$$

**Definition 3.16.** We call the probability measure $P^\star \sim P$ with density process $Z^{P^\star}$ **opportunity-neutral probability measure**.

The opportunity-neutral probability measure is typically not a martingale measure. In some instances it actually equals $P$ (cf. Section 3.6). For later use we determine the $P^\star$-characteristics of $S$.

**Lemma 3.17.** The components of $S$ are locally $P^\star$-square integrable semimartingales. Moreover,

$$b^{S^\star} = \frac{\bar{b}}{1 + \Delta A^K},$$

$$\tilde{c}^{S^\star} = \frac{\bar{c}}{1 + \Delta A^K},$$

$$(1 + (b^{S^\star})^\top (\hat{c}^{S^\star})^{-1} b^{S^\star} \Delta A)(1 - (b^{S^\star})^\top (\tilde{c}^{S^\star})^{-1} b^{S^\star} \Delta A) = 1$$

and

$$\hat{c}^{S^\star}(\hat{c}^{S^\star})^{-1} b^{S^\star} = b^{S^\star},$$

$$\tilde{c}^{S^\star}(\tilde{c}^{S^\star})^{-1} b^{S^\star} = b^{S^\star},$$

$$\bar{c}\bar{c}^{-1}\bar{b} = \bar{b}$$

$P \otimes A$-almost everywhere, where

$$\bar{b} := b^S + c^{SL}\frac{1}{L_-} + \int x\frac{y}{L_-} F^{S,L}(d(x,y))$$
$$= b^S + c^{SK} + \int xy F^{S,K}(d(x,y))$$

and

$$\bar{c} := c^S + \int xx^\top \left(1 + \frac{y}{L_-}\right) F^{S,L}(d(x,y))$$
$$= c^S + \int xx^\top (1 + y) F^{S,K}(d(x,y)).$$

### 3.5. Characterization of $L$ and $\tilde{a}$

The opportunity process $L$ and the adjustment process $\tilde{a}$ play a crucial role in quadratic hedging. For example, they yield the density processes of the variance-optimal S$\sigma$MM $Q^\star$ and the opportunity-neutral measure $P^\star$, which in turn lead to formulas for the optimal hedge in Section 4. The characterizations of $L$ and $\tilde{a}$ in this section help to determine these processes in concrete models.

**Lemma 3.19.** We have

$$b^L = L_- \tilde{a}^\top \bar{b},$$

$$\bar{b} = \bar{c}\tilde{a},$$

$$b^K = \bar{b}^\top \bar{c}^{-1} \bar{b} = (b^{S^\star})^\top (\hat{c}^{S^\star})^{-1} b^{S^\star}$$

outside some $P \otimes A$-null set, where $\bar{b}, \bar{c}$ are defined in (3.23) and (3.25).

**Corollary 3.20.** The adjustment process and the extended adjustment process satisfy the equations

$$b^{S^\star} = \tilde{c}^{S^\star}\tilde{a} = \hat{c}^{S^\star}\hat{a}$$

or, put differently,

$$A^{S^\star} = \tilde{a} \bullet \langle S, S \rangle^{P^\star} = \hat{a} \bullet \langle M^{S^\star}, M^{S^\star} \rangle^{P^\star}.$$

In the univariate case, this can be written more intuitively in terms of pathwise Radon–Nikodym derivatives:

$$\tilde{a}_t = \frac{dA^{S^\star}_t}{d\langle S, S \rangle^{P^\star}_t}, \quad \hat{a}_t = \frac{dA^{S^\star}_t}{d\langle M^{S^\star}, M^{S^\star} \rangle^{P^\star}_t}.$$

**Definition 3.22.** We call

$$N^\star := -\hat{a} \bullet M^{S^\star}$$

**$P^\star$-minimal logarithm process**.

The terminology is motivated by the fact that $\mathcal{E}(N^\star)$ is essentially the density process of the so-called minimal signed martingale measure relative to $P^\star$ instead of $P$ (in the sense of [44], (3.14)).

**Lemma 3.23.** We have

$$\frac{L_0}{E(L_0)}\mathcal{E}(N) = Z^{P^\star}\mathcal{E}(N^\star).$$

Consequently, $\mathcal{E}(N^\star)$ is the density process of $Q^\star$ relative to $P^\star$.

**Lemma 3.24.** $N^\star$ and $S + [S, N^\star]$ are $P^\star$-$\sigma$-martingales, which implies that $S\mathcal{E}(N^\star)$ is a $P^\star$-$\sigma$-martingale as well.

**Theorem 3.25.** The opportunity process is the unique semimartingale $L$ such that:

1. $L$, $L_-$ are $(0, 1]$-valued,
2. $L_T = 1$,
3. The joint characteristics of $(S, L)$ solve the equation

$$b^L = L_- \bar{b}^\top \bar{c}^{-1} \bar{b}$$

outside some $P \otimes A$-null set, where $\bar{b}, \bar{c}$ are defined as in (3.23), (3.25),

4. $a\mathcal{E}((-a\mathbf{1}_{]\!]\tau,T]\!]}) \bullet S)_- \mathbf{1}_{]\!]\tau,T]\!]} \in \Theta$,

$$\mathcal{E}((-a\mathbf{1}_{]\!]\tau,T]\!]}) \bullet S)L \text{ is of class (D)}$$

hold for $a := \bar{c}^{-1}\bar{b}$ and any stopping time $\tau$.

In this case $a = \bar{c}^{-1}\bar{b}$ meets the requirement of an adjustment process $\tilde{a}$ in Lemma 3.7.

### 3.6. When does $P^\star = P$ hold?

The opportunity-neutral measure plays a key role in quadratic hedging. Therefore we want to have a closer look at the question when $P^\star$ equals $P$. In line with [42], we call

$$\widehat{K} := ((b^S)^\top (\hat{c}^S)^{-1} b^S) \bullet A$$

**mean-variance tradeoff (MVT) process**. Similarly, the MVT process relative to $P^\star$ is denoted by $\widehat{K}^\star$, that is,

$$\widehat{K}^\star := ((b^{S^\star})^\top (\hat{c}^{S^\star})^{-1} b^{S^\star}) \bullet A.$$

Observe that $\widehat{K}^\star = A^K$ by (3.29).

**Proposition 3.28.** The following statements are equivalent:

1. $P^\star = P$.
2. $K$ (or equivalently $L$) is a predictable process of finite variation and $L_0$ is deterministic.
3. $K = \widehat{K}$ and $L_0$ is deterministic.
4. $K = \widehat{K}^\star$ and $L_0$ is deterministic.
5. $\mathcal{E}(\widehat{K})_T$ is finite and deterministic.
6. $\mathcal{E}(\widehat{K}^\star)_T$ is deterministic.

In this case the opportunity process equals $L = \mathcal{E}(\widehat{K})/\mathcal{E}(\widehat{K})_T$.

**Definition 3.29.** If $\mathcal{E}(-\hat{\lambda} \bullet M^S)$ is of class (D) and hence a martingale, then it is the density process of some S$\sigma$MM $Q$. Only slightly extending [44], (3.14) we call $Q$ the **minimal signed martingale measure (minimal S$\sigma$MM)**.

**Corollary 3.30.** Suppose $\mathcal{E}(-\tilde{a} \bullet S)_T \neq 0$ almost surely. Then there is equivalence between:

1. $P^\star = P$,
2. $\widehat{K}_T$ is finite, the minimal S$\sigma$MM $Q$ exists, $Q^\star = Q$, and $\tilde{a}$ can be chosen as $\tilde{\lambda}$.

The implication $1 \Rightarrow 2$ still holds without the assumption on $\mathcal{E}(-\tilde{a} \bullet S)$.

**Corollary 3.31.** If the MVT process $\widehat{K}$ is finite and deterministic, then $L := \mathcal{E}(\widehat{K})/\mathcal{E}(\widehat{K})_T$ is the opportunity process, $K := \widehat{K}$ is the modified mean-variance tradeoff process, and $P^\star = P$.

### 3.7. Determination of the opportunity process

Unless we are in the fortunate situation of Corollary 3.31 or at least Proposition 3.28, the crucial step in concrete applications is to determine the opportunity process $L$. This is relatively easy in discrete time.

**Example 3.32.** Suppose that we are actually considering a discrete-time model, that is, $A_t = [t] := \max\{n \in \mathbb{N} : n \leq t\}$ and $\mathcal{F}_t = \mathcal{F}_{[t]}$ for $t \in [0, T]$ with $T \in \mathbb{N}$. In this case all processes in this paper are (or can be chosen) piecewise constant between integer times. For ease of notation suppose that $d = 1$ (only one tradable asset). By [28], II.3.11 we have $b^L_t = E(\Delta L_t | \mathcal{F}_{t-1})$, $\bar{b}_t = E(\Delta S_t L_t / L_{t-1} | \mathcal{F}_{t-1})$, and $\bar{c}_t = E((\Delta S_t)^2 L_t / L_{t-1} | \mathcal{F}_{t-1})$ for $t \in \{1, 2, \ldots, T\}$. Consequently, (3.32) can be rewritten as

$$L_{t-1} = E(L_t | \mathcal{F}_{t-1}) - \frac{(E(\Delta S_t L_t | \mathcal{F}_{t-1}))^2}{E((\Delta S_t)^2 L_t | \mathcal{F}_{t-1})},$$

that is, the opportunity process is determined by a simple backward recursion starting in $L_T = 1$. For the adjustment process we have

$$\tilde{a}_t = \frac{\bar{b}_t}{\bar{c}_t} = \frac{E(\Delta S_t L_t | \mathcal{F}_{t-1})}{E((\Delta S_t)^2 L_t | \mathcal{F}_{t-1})}.$$

The previous example indicates that the characteristic equation (3.32) may be interpreted as the continuous-time analogue of a backward recursion. True continuous-time models are typically Markovian in $S_t$ or at least $(S_t, Y_t)$ with some additional process $Y$ as, for example, stochastic volatility. If one makes the natural assumption $L_t = f(t, S_t, Y_t)$ with some $C^2$-function $f$, then (3.32) can be rewritten as an integro-differential equation for $f$ by means of Itô's formula. But as it is not obvious whether the smoothness assumption is justified, it may require substantial effort to make this statement precise. In [11] and ongoing research, $L$ is determined explicitly by an ansatz of the above type in specific stochastic volatility models.

---

## 4. On the Quadratic Hedging Problem

We now come back to the hedging problem from Definition 2.10. The processes and measures $\lambda^{(\tau)}$, $M^{(\tau)}$, $L$, $\tilde{a}$, $\hat{a}$, $K$, $N$, $Q^\star$, $Z^{P^\star}$, $P^\star$, $\bar{b}$, $\bar{c}$ are defined as in the previous section. Recall that $P$ is the default probability measure for expectations, martingales and so forth.

### 4.1. Mean value process and pure hedge coefficient

If $S$ is a martingale, the mean value process $V_t = E(H|\mathcal{F}_t)$ leads to the optimal hedge via (1.1). If $S$ fails to be a martingale, a similar role is played by the conditional expectation of $H$ relative to the variance-optimal S$\sigma$MM $Q^\star$. By the generalized Bayes formula we have

$$E_{Q^\star}(H|\mathcal{F}_t) = E(H\mathcal{E}(N - N^t)_T | \mathcal{F}_t)$$

if $Q^\star$ is a true probability measure. In the general case we use the right-hand side of (4.1) as a substitute for the possibly undefined conditional expectation.

**Lemma 4.1.** There is a unique semimartingale $V$ satisfying

$$V_t = E(H\mathcal{E}(N - N^t)_T | \mathcal{F}_t)$$
$$= E_{P^\star}(H\mathcal{E}(N^\star - (N^\star)^t)_T | \mathcal{F}_t)$$

for $t \in [0, T]$. Moreover, $(V_s M^{(t)}_s)_{s \in [t,T]}$ is a martingale for any $t \in [0, T]$.

**Definition 4.2.** We call $V$ from Lemma 4.1 **mean value process** of the option.

The following technical statements mean essentially that $V$ is a $Q^\star$-$\sigma$-martingale.

**Lemma 4.3.** We have:
1. $V + [V, N]$ and hence $V\mathcal{E}(N)$ are $\sigma$-martingales.
2. $V + [V, N^\star]$ and hence $V\mathcal{E}(N^\star)$ are $P^\star$-$\sigma$-martingales.

**Lemma 4.4.** We have:
1. $V^2 L$, $(v + \vartheta \bullet S)^2 L$, and $(v + \vartheta \bullet S - V)^2 L$ are submartingales for any admissible endowment/strategy pair $(v, \vartheta)$.
2. $V$ is a locally square-integrable semimartingale relative to $P^\star$.

**Lemma 4.5.** Outside some $P \otimes A$-null set we have

$$b^{V^\star} = \tilde{c}^{VS^\star}\tilde{a},$$

$$\tilde{c}^{S^\star}(\tilde{c}^{S^\star})^{-1}\tilde{c}^{SV^\star} = \tilde{c}^{SV^\star}.$$

**Definition 4.6.** We call the process

$$\xi := (\tilde{c}^{S^\star})^{-1}\tilde{c}^{SV^\star}$$

**pure hedge coefficient**.

The following representations of $\xi$ establish the link to (1.1).

**Proposition 4.7.** The pure hedge coefficient $\xi$ satisfies

$$\xi \bullet \langle S, S \rangle^{P^\star} = \langle S, V \rangle^{P^\star}$$

and

$$\xi \bullet \langle M^{S^\star}, M^{S^\star} \rangle^{P^\star} = \langle M^{S^\star}, M^{V^\star} \rangle^{P^\star}.$$

In the univariate case, (4.8) and (4.9) can be written more plainly as

$$\xi_t = \frac{d\langle S, V \rangle^{P^\star}_t}{d\langle S, S \rangle^{P^\star}_t} = \frac{d\langle M^{S^\star}, M^{V^\star} \rangle^{P^\star}_t}{d\langle M^{S^\star}, M^{S^\star} \rangle^{P^\star}_t}.$$

**Lemma 4.8.** There exists a $P^\star$-local martingale $M$ with $M_0 = 0$ that is $P^\star$-orthogonal to $M^{S^\star}$ (in the sense that $M^{S^\star}M$ is a $P^\star$-local martingale) and such that

$$V = V_0 + \xi \bullet S + M$$

holds.

Equation (4.13) can be interpreted as a process version of the $P^\star$-Föllmer–Schweizer decomposition of $H$. The integrand in the latter yields the locally risk-minimizing hedging strategy in the sense of [41] or [18] relative to $P^\star$.

### 4.2. Main results

**Lemma 4.9.** For any $\mathcal{F}_0$-measurable random variable $v$, the feedback equation

$$\varphi_t = \xi_t - (v + \varphi \bullet S_{t-} - V_{t-})\tilde{a}_t$$

has a unique solution $\varphi^{(v)} := \varphi \in L(S)$.

We are now ready to state our first main result.

**Theorem 4.10.**
1. The process $\varphi := \varphi^{(v_0)}$ given by the feedback expression (4.14) is an optimal hedging strategy for initial endowment $v_0 \in L^2(\Omega, \mathcal{F}_0, P)$.
2. $(v_0, \varphi) := (V_0, \varphi^{(V_0)})$ is an optimal endowment/strategy pair.

As is well known, the gains process $\varphi \bullet S$ can be expressed more explicitly.

**Corollary 4.11.** The gains process of the optimal hedge in Theorem 4.10 equals

$$\varphi \bullet S = \mathcal{E}(-\tilde{a} \bullet S)\left(\frac{\xi + (V_- - v_0)\tilde{a}}{\mathcal{E}(-\tilde{a} \bullet S)_-} \bullet S + \frac{\tilde{a}}{1 - \tilde{a}^\top \Delta S} \bullet [S, S]\right)$$

unless $\mathcal{E}(-\tilde{a} \bullet S)$ jumps to 0.

Finally, we state formulas for the hedging error.

**Theorem 4.12.** The expected squared hedging error of the optimal hedge in Theorem 4.10 equals

$$E\left((v_0 + \varphi \bullet S_T - H)^2\right)$$
$$= E\left((v_0 - V_0)^2 L_0 + ((\tilde{c}^{V^\star} - (\tilde{c}^{SV^\star})^\top (\tilde{c}^{S^\star})^{-1} \tilde{c}^{SV^\star})L) \bullet A_T\right)$$
$$= E\left((v_0 - V_0)^2 L_0 + L \bullet (\langle V, V \rangle^{P^\star} - \xi \bullet \langle V, S \rangle^{P^\star})_T\right)$$
$$= E_{P^\star}\left((v_0 - V_0)^2 + ((\tilde{c}^{V^\star} - (\tilde{c}^{SV^\star})^\top (\tilde{c}^{S^\star})^{-1} \tilde{c}^{SV^\star})\mathcal{E}(A^K)) \bullet A_T\right)E(L_0)$$
$$= E_{P^\star}\left((v_0 - V_0)^2 + \mathcal{E}(A^K) \bullet \langle V - \xi \bullet S, V - \xi \bullet S \rangle^{P^\star}_T\right)E(L_0).$$

### 4.3. Connections to the literature

In this section we clarify the link of our results to the literature. If $S$ is a martingale, we are in the setup of Föllmer and Sondermann [19]. In our notation, they show that the optimal hedge $\varphi$ satisfies

$$\varphi_t = \frac{d\langle S, V \rangle_t}{d\langle S, S \rangle_t},$$

where

$$V_t = E(H|\mathcal{F}_t).$$

Applying our results to the martingale case, one immediately verifies that $L = 1$, $\tilde{a} = 0$, $K = 0$, $N = 0$, $Q^\star = P^\star = P$. Consequently, equation (4.2) for the mean-value process of the option reduces to (4.27). Moreover, the optimal hedge $\varphi$ coincides with the pure hedge $\xi$, which satisfies $\xi \bullet \langle S, S \rangle = \langle S, V \rangle$ in accordance with (4.26).

Schweizer [42] goes beyond the martingale case. He shows that if the MVT process $\widehat{K}$ is deterministic, then the optimal hedging strategy for initial endowment $v_0$ contains a feedback element and is of the form

$$\varphi_t = \xi_t - (v_0 + \varphi \bullet S_{t-} - V_{t-})\tilde{\lambda}_t$$

with $\tilde{\lambda}$ from (3.35). Here, the pure hedge coefficient $\xi$ is the integrand in the Föllmer–Schweizer decomposition of the claim, that is,

$$H = V_0 + \xi \bullet S_T + R_T,$$

where $V_0$ is a $\mathcal{F}_0$-measurable random variable and $R$ denotes a martingale which is orthogonal to $M^S$ (in the sense that $M^S R$ is a local martingale).

In order to express the pure hedge coefficient similarly as in (4.26), recall that the minimal signed martingale measure $Q$ is given by

$$\frac{dQ}{dP} := \mathcal{E}(-\hat{\lambda} \bullet M^S)_T.$$

If we define $V$ as "$Q$-conditional expectation" of $H$ in the sense of

$$V_t := E(H\mathcal{E}((-\hat{\lambda}\mathbf{1}_{]\!]t,T]\!]}) \bullet M^S)_T | \mathcal{F}_t),$$

then the pure hedge coefficient can be written as

$$\xi_t = \frac{d\langle S, V \rangle_t}{d\langle S, S \rangle_t} = \frac{d\langle M^S, M^V \rangle_t}{d\langle M^S, M^S \rangle_t}.$$

The hedging error satisfies the equation

$$E\left((v_0 + \varphi \bullet S_T - H)^2\right) = E\left((v_0 - V_0)^2 + \mathcal{E}(\widehat{K}) \bullet \langle V - \xi \bullet S, V - \xi \bullet S \rangle_T\right)\frac{1}{\mathcal{E}(\widehat{K})_T}.$$

In these formulas, all predictable covariation processes refer to the original probability measure $P$.

It is easy to see that (4.28)–(4.31) are special cases of our general results. To this end, recall that $L = \mathcal{E}(\widehat{K})/\mathcal{E}(\widehat{K})_T$, $P^\star = P$, and $\tilde{a} = \tilde{\lambda}$ in the case of deterministic MVT (cf. Corollaries 3.31 and 3.30). Hence

$$N^\star = -((1 + \Delta A^K)\tilde{a}) \bullet M^{S^\star} = -\hat{\lambda} \bullet M^S.$$

Consequently, (4.28), (4.29), (4.30), (4.31) correspond to (4.14), (4.3), (4.10), (4.23), respectively.

If the MVT process fails to be deterministic, the above formulas do not lead to the optimal hedge any more. Following Hipp [22], [44] observes that a key role in the general case is played by the variance optimal signed martingale measure $Q^\star$ and the adjustment process $\tilde{a}$. Schweizer characterizes both the adjustment process and the optimal hedging strategy in terms of backward stochastic differential equations. The use of these BSDEs in practice is complicated by their involved boundary conditions, which themselves depend on the unknown solution.

Rheinländer and Schweizer [40] show that the optimal hedging strategy $\varphi$ satisfies similar equations as in the case of deterministic MVT if $S$ is continuous. More specifically, it is of feedback form

$$\varphi_t = \xi_t - (v_0 + \varphi \bullet S_{t-} - V_{t-})\tilde{a}_t,$$

where $V_t := E_{Q^\star}(H|\mathcal{F}_t)$ is the martingale generated by $H$ relative to the variance-optimal S$\sigma$MM $Q^\star$ and the pure hedge coefficient $\xi$ is the integrand in the Galtchouk–Kunita–Watanabe decomposition of $H$ relative to $Q^\star$ rather than $P$, that is,

$$\xi_t = \frac{d\langle S, V \rangle^{Q^\star}_t}{d\langle S, S \rangle^{Q^\star}_t}.$$

This equation corresponds to our expression (4.10) because the predictable covariation does not depend on the probability measure for continuous processes.

An alternative approach in the continuous case is pursued by Gourieroux, Laurent and Pham [20] who use a new numeraire $\mathcal{E}(-\tilde{a} \bullet S)$ combined with a change of measure to transform the original semimartingale problem to a martingale problem à la Föllmer and Sondermann [19]. The task of computing $\tilde{a}$ has become a separate issue in the literature. It is tackled in a number of diffusion or jump-diffusion settings, for example, by Laurent and Pham [30], Biagini, Guasoni and Pratelli [6], Biagini and Guasoni [5], Hobson [24]. Our characterization of the adjustment process in Theorem 3.25 appears to be more suitable for direct computations than the methods available to date (cf. [11]).

The literature on discontinuous processes is more limited. Two partial results are reported by Arai [3] and Lim [33]. Arai extends the numeraire method of Gourieroux, Laurent and Pham [20] to discontinuous semimartingales assuming that $Q^\star$ is equivalent to $P$ and shows that $V$ in (4.3) is a $Q^\star$-martingale. However, Arai's results are hard to use for explicit computations since he does not provide a method for obtaining $\tilde{a}$.

Lim [33] uses BSDEs to compute the optimal hedge in a jump diffusion setting where asset price characteristics are adapted to a Brownian filtration. In addition he requires a certain martingale invariance property. He characterizes the optimal hedge explicitly at the cost of a somewhat restrictive model setup.

Finally, we want to explain another close link of our results to the formulas (4.28–4.31) of [42]. We already observed in Lemma 3.23 that the variance-optimal S$\sigma$MM $Q^\star$ is the minimal S$\sigma$MM relative to $P^\star$. Moreover, $\tilde{a}$ and $\hat{a}$ coincide with the processes $\tilde{\lambda}$ and $\hat{\lambda}$ in [42] or Section 3.6 relative to $P^\star$ instead of $P$. Consequently, equations (4.14), (4.3), (4.10) are $P^\star$-versions of the formulas (4.28), (4.29), (4.30). The change of measure $P \to P^\star$ neutralizes the effect of stochastic mean-variance tradeoff which makes the results in [42] break down. With the hedging error one has to be slightly more careful. Since $\widehat{K}^\star = A^K$, we can view (4.23) essentially as a $P^\star$-version of (4.31). We only have to replace the deterministic second factor $1/\mathcal{E}(\widehat{K})_T$ by

$$E\left(\frac{1}{L_T}\right) = E\left(\frac{1}{\mathcal{E}(A^K)_T}\right) = E_{P^\star}\left(\frac{1}{\mathcal{E}(\widehat{K}^\star)_T}\right) = E(L_0).$$

---

## Appendix

### A.1. Locally square-integrable semimartingales

**Definition A.1.** For any special semimartingale $X$ we define

$$\|X\|_{\mathcal{S}^2} := \|X_0\|_2 + \|[M^X, M^X]_T\|_2 + \|\text{var}(A^X)_T\|_2,$$

where $\text{var}(A^X)$ denotes the variation process of $A^X$ and $\|\cdot\|_2$ the $L^2$-norm. $X$ is said to belong to the set $\mathcal{S}^2$ of **square-integrable semimartingales** if $\|X\|_{\mathcal{S}^2} < \infty$. The elements of the corresponding localized class $\mathcal{S}^2_{loc}$ are called **locally square-integrable semimartingales**.

**Lemma A.2.** For any semimartingale $X$, we have equivalence between:

1. $X \in \mathcal{S}^2_{loc}$.
2. $X_0 \in L^2(P)$ and $X$ is a locally square-integrable semimartingale in the sense of [28], II.2.27, that is, it is a special semimartingale whose local martingale part is locally square-integrable.
3. $X$ is locally in $L^2$ in the sense of [15], that is, it belongs locally to the class of processes $Y$ with $\sup\{E(Y^2_\tau) : \tau \text{ finite stopping time}\} < \infty$.
4. $X$ belongs locally to the class of processes $Y$ satisfying $E(Y^2_\tau) < \infty$ for any finite stopping time $\tau$.

**Lemma A.3.** Let $X$ be a locally square-integrable semimartingale such that $\langle M^X, M^X \rangle$ and the variation process $\text{var}(A^X)$ are bounded. Then

$$E\left(\sup_t \mathcal{E}(X)^2_t\right) < \infty.$$

### A.2. $\sigma$-Martingales

**Definition A.4.** A semimartingale $X$ is called **$\sigma$-martingale** if there exists an increasing sequence $(D_n)_{n \in \mathbb{N}}$ of predictable sets such that $D_n \uparrow \Omega \times \mathbb{R}_+$ up to an evanescent set and $\mathbf{1}_{D_n} \bullet X$ is a uniformly integrable martingale for any $n \in \mathbb{N}$.

**Remark A.5.** Uniformly integrable martingale can be replaced by local martingale in the previous definition.

**Lemma A.6.** Let $X$ be a semimartingale with differential characteristics $(b, c, F, A)$ relative to some truncation function $h$. Then $X$ is a $\sigma$-martingale if and only if $\int_{\{|x|>1\}} |x| F(dx) < \infty$ and

$$b + \int (x - h(x))F(dx) = 0$$

hold outside some $P \otimes A$-null set.

**Lemma A.7.** $X$ is a uniformly integrable martingale if and only if it is a $\sigma$-martingale of class (D).

**Lemma A.8.** Let $P^\star \sim P$ be a probability measure with density process $Z$. A real-valued semimartingale $X$ is a $P^\star$-$\sigma$-martingale if and only if $XZ$ is a $P$-$\sigma$-martingale.

**Lemma A.9.** Let $X$ be a $\mathbb{R}^d$-valued semimartingale and let $P^\star \sim P$ be a probability measure with density process $Z = Z_0 \mathcal{E}(N)$. Denote by

$$(b^{X,N}, c^{X,N}, F^{X,N}, A) = \left(\begin{pmatrix} b^X \\ b^N \end{pmatrix}, \begin{pmatrix} c^X & c^{XN} \\ c^{NX} & c^N \end{pmatrix}, F^{X,N}, A\right)$$

differential characteristics of the $\mathbb{R}^{d+1}$-valued semimartingale $(X, N)$ relative to some truncation function $h$. Then a version of the $P^\star$-differential characteristics of $(X, N)$ is given by $(b^{X,N^\star}, c^{X,N^\star}, F^{X,N^\star}, A)$, where

$$b^{X,N^\star} = b^{X,N} + c^{XN} + \int h(x,y) y F^{X,N}(d(x,y)),$$
$$c^{X,N^\star} = c^{X,N},$$
$$\frac{dF^{X,N^\star}}{dF^{X,N}}(x,y) = 1 + y.$$

**Lemma A.10.** If $X$ is a $\sigma$-martingale and $\vartheta \in L(X)$, then $\vartheta \bullet X$ is a $\sigma$-martingale as well.

**Lemma A.11.** Let $X$ be a $\mathbb{R}^d$-valued semimartingale and $\vartheta$ an $\mathbb{R}^d$-valued predictable process. Then $\vartheta \in L(X)$ if and only if there exists a semimartingale $Z$ with $Z_0 = 0$ and an increasing sequence $(D_n)_{n \in \mathbb{N}}$ of predictable sets such that $D_n \uparrow \Omega \times \mathbb{R}_+$ up to an evanescent set, $\vartheta \mathbf{1}_{D_n}$ is bounded, and $\mathbf{1}_{D_n} \bullet Z = (\vartheta \mathbf{1}_{D_n}) \bullet X$ for any $n \in \mathbb{N}$. In this case $Z = \vartheta \bullet X$.

---

## Acknowledgments

Parts of this research were done while the second author was visiting Helsinki University of Technology. He wants to thank Esko Valkeila for his hospitality. Both authors thank the Isaac Newton Institute for the opportunity to work on the subject during the program on quantitative finance. We are grateful to Thorsten Rheinländer, Christophe Stricker, Shige Peng, Jean Jacod, and Martin Schweizer for valuable comments or discussions. Thanks are also due to an anonymous referee for his detailed suggestions which enhanced the presentation of the results.

---

## References

[1] Albert, A. (1972). *Regression and the Moore–Penrose Pseudoinverse*. Academic Press, New York.

[2] Arai, T. (2004). Minimal martingale measures for jump diffusion processes. *J. Appl. Probab.* **41** 263–270.

[3] Arai, T. (2005). An extension of mean-variance hedging to the discontinuous case. *Finance Stoch.* **9** 129–139.

[4] Benth, F., Di Nunno, G., Løkka, A., Øksendal, B. and Proske, F. (2003). Explicit representation of the minimal variance portfolio in markets driven by Lévy processes. *Math. Finance* **13** 55–72.

[5] Biagini, F. and Guasoni, P. (2002). Mean-variance hedging with random volatility jumps. *Stochastic Anal. Appl.* **20** 471–494.

[6] Biagini, F., Guasoni, P. and Pratelli, M. (2000). Mean-variance hedging for stochastic volatility models. *Math. Finance* **10** 109–123.

[7] Bobrovnytska, O. and Schweizer, M. (2004). Mean-variance hedging and stochastic control: Beyond the Brownian setting. *IEEE Trans. Automat. Control* **49** 396–408.

[8] Černý, A. (2004). Dynamic programming and mean-variance hedging in discrete time. *Appl. Math. Finance* **11** 1–25.

[9] Černý, A. (2005). Optimal continuous-time hedging with leptokurtic returns. *Math. Finance*. To appear.

[10] Černý, A. and Kallsen, J. (2006). A counterexample concerning the variance-optimal martingale measure. *Math. Finance*. To appear.

[11] Černý, A. and Kallsen, J. (2006). Mean-variance hedging and optimal investment in Heston's model with correlation. SSRN working paper.

[12] Choulli, T., Krawczyk, L. and Stricker, C. (1998). $\mathcal{E}$-martingales and their applications in mathematical finance. *Ann. Probab.* **26** 853–876.

[13] Delbaen, F., Monat, P., Schachermayer, W., Schweizer, M. and Stricker, C. (1997). Weighted norm inequalities and hedging in incomplete markets. *Finance and Stochastics* **1** 181–227.

[14] Delbaen, F. and Schachermayer, W. (1995). The existence of absolutely continuous local martingale measures. *Ann. Appl. Probab.* **5** 926–945.

[15] Delbaen, F. and Schachermayer, W. (1996). Attainable claims with $p$'th moments. *Ann. Inst. H. Poincaré Probab. Statist.* **32** 743–763.

[16] Delbaen, F. and Schachermayer, W. (1996). The variance-optimal martingale measure for continuous processes. *Bernoulli* **2** 81–105.

[17] Di Nunno, G. (2002). Stochastic integral representation, stochastic derivatives and minimal variance hedging. *Stochastics Stochastics Rep.* **73** 181–198.

[18] Föllmer, H. and Schweizer, M. (1991). Hedging of contingent claims under incomplete information. In *Applied Stochastic Analysis* (M. H. A. Davis and R. J. Elliott, eds.) 389–414. Gordon and Breach, London.

[19] Föllmer, H. and Sondermann, D. (1986). Hedging of nonredundant contingent claims. In *Contributions to Mathematical Economics* 205–223. North-Holland, Amsterdam.

[20] Gourieroux, C., Laurent, J. and Pham, H. (1998). Mean-variance hedging and numéraire. *Math. Finance* **8** 179–200.

[21] Grandits, P. and Rheinländer, T. (2002). On the minimal entropy martingale measure. *Ann. Probab.* **30** 1003–1038.

[22] Hipp, C. (1993). Hedging general claims. In *Proceedings of the 3rd AFIR Colloquium, Rome* **2** 603–613.

[23] Hipp, C. and Taksar, M. (2005). Hedging in incomplete markets and optimal control. To appear.

[24] Hobson, D. (2004). Stochastic volatility models, correlation, and the $q$-optimal martingale measure. *Math. Finance* **14** 537–556.

[25] Hou, C. and Karatzas, I. (2004). Least-squares approximation of random variables by stochastic integrals. In *Stochastic Analysis and Related Topics in Kyoto* 141–166. Math. Soc. Japan, Tokyo.

[26] Hubalek, F., Krawczyk, L. and Kallsen, J. (2006). Variance-optimal hedging for processes with stationary independent increments. *Ann. Appl. Probab.* **16** 853–885.

[27] Jacod, J. (1979). *Calcul Stochastique et Problèmes de Martingales*. Springer, Berlin.

[28] Jacod, J. and Shiryaev, A. (2003). *Limit Theorems for Stochastic Processes*, 2nd ed. Springer, Berlin.

[29] Kallsen, J. (2004). $\sigma$-localization and $\sigma$-martingales. *Theory Probab. Appl.* **48** 152–163.

[30] Laurent, J. and Pham, H. (1999). Dynamic programming and mean-variance hedging. *Finance Stoch.* **3** 83–110.

[31] Leitner, J. (2001). Mean-variance efficiency and intertemporal price for risk. Technical Report 00/35, Center of Finance and Econometrics, Univ. Konstanz.

[32] Lim, A. (2004). Quadratic hedging and mean-variance portfolio selection with random parameters in an incomplete market. *Math. Oper. Res.* **29** 132–161.

[33] Lim, A. (2005). Mean-variance hedging when there are jumps. *SIAM J. Control Optim.* **44** 1893–1922.

[34] Mania, M. and Tevzadze, R. (2000). A semimartingale Bellman equation and the variance-optimal martingale measure. *Georgian Math. J.* **7** 765–792.

[35] Mania, M. and Tevzadze, R. (2003). Backward stochastic PDE and imperfect hedging. *Int. J. Theor. Appl. Finance* **6** 663–692.

[36] Mania, M. and Tevzadze, R. (2003). A semimartingale backward equation and the variance-optimal martingale measure under general information flow. *SIAM J. Control Optim.* **42** 1703–1726.

[37] Monat, P. and Stricker, C. (1995). Föllmer–Schweizer decomposition and mean-variance hedging for general claims. *Ann. Probab.* **23** 605–628.

[38] Pham, H. (2000). On quadratic hedging in continuous time. *Math. Methods Oper. Res.* **51** 315–339.

[39] Protter, P. (2004). *Stochastic Integration and Differential Equations*, 2nd ed. Springer, Berlin.

[40] Rheinländer, T. and Schweizer, M. (1997). On $L^2$-projections on a space of stochastic integrals. *Ann. Probab.* **25** 1810–1831.

[41] Schweizer, M. (1991). Option hedging for semimartingales. *Stochastic Process. Appl.* **37** 339–363.

[42] Schweizer, M. (1994). Approximating random variables by stochastic integrals. *Ann. Probab.* **22** 1536–1575.

[43] Schweizer, M. (1995). On the minimal martingale measure and the Föllmer–Schweizer decomposition. *Stochastic Anal. Appl.* **13** 573–599.

[44] Schweizer, M. (1996). Approximation pricing and the variance-optimal martingale measure. *Ann. Probab.* **24** 206–236.

[45] Schweizer, M. (2001). A guided tour through quadratic hedging approaches. In *Option Pricing, Interest Rates and Risk Management* (E. Jouini, J. Cvitanic, and M. Musiela, eds.) 538–574. Cambridge Univ. Press.

[46] Sekine, J. (2004). On the computation of $L^2$-hedging strategy with stochastic volatility. Unpublished manuscript.

[47] Stricker, C. (1990). Arbitrage et lois de martingale. *Ann. Inst. H. Poincaré Probab. Statist.* **26** 451–460.

[48] Xia, J. and Yan, J. (2006). Markowitz's portfolio optimization in an incomplete market. *Math. Finance* **16** 203–216.

---

**Authors' Addresses:**

Aleš Černý
Cass Business School
City University London
106 Bunhill Row
London EC1Y 8TZ
United Kingdom
E-mail: cerny@martingales.info

Jan Kallsen
HVB-Stiftungsinstitut für Finanzmathematik
Zentrum Mathematik
Technische Universität München
Boltzmannstraße 3
85747 Garching bei München
Germany
E-mail: kallsen@ma.tum.de
