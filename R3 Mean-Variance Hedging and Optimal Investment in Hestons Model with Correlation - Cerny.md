# Mean-Variance Hedging and Optimal Investment in Heston's Model with Correlation

**Authors:** Aleš Černý (City University London) and Jan Kallsen (Christian-Albrechts-Universität zu Kiel)

**Journal:** Mathematical Finance, Vol. 18, No. 3 (July 2008), 473–492

---

## Abstract

This paper solves the mean-variance hedging problem in Heston's model with a stochastic opportunity set moving systematically with the volatility of stock returns. We allow for correlation between stock returns and their volatility (so-called leverage effect). Our contribution is threefold: using a new concept of opportunity-neutral measure we present a simplified strategy for computing a candidate solution in the correlated case. We then go on to show that this candidate generates the true variance-optimal martingale measure; this step seems to be partially missing in the literature. Finally, we derive formulas for the hedging strategy and the hedging error.

**Keywords:** mean-variance hedging, stochastic volatility, Heston's model, affine process, option pricing, optimal investment

---

## 1. Introduction

We examine a classical problem in mathematical finance: how to optimally hedge a given static position in a derivative asset $H$ with payoff at time $T$ by dynamic trading in the underlying asset $S$ if the hedger wishes to minimize the expected squared hedging error.

A crucial step on the way to the optimal hedge is to derive the density process of the so-called variance-optimal martingale measure (VOMM) or, more or less equivalently, the optimal strategy of a pure investment problem with quadratic utility. We focus on a model with stochastic volatility in which the instantaneous Sharpe ratio of stock returns changes with the volatility level and volatility itself is correlated with the change in stock price. This model is a modification of Heston (1993).

In the case of zero correlation, the problem at hand has been solved by Heath et al. (2001), drawing on the results of Laurent and Pham (1999). In principle, the VOMM in the correlated case has been explicitly determined by Hobson (2004). Our contribution is threefold: using a new concept of opportunity-neutral measure (cf. Černý and Kallsen 2007, hereafter CK07) we present a simplified strategy for computing a candidate solution in the correlated case. We then go on to show that this candidate is the true VOMM. Finally, we derive formulas for the hedging strategy and the hedging error, again based on CK07.

The assumption of zero interest rates is standard in the literature and it entails no loss of generality within the class of models with deterministic interest rates; we shall therefore adopt it here. The task of the hedger is to solve

$$\inf_{\vartheta} E\left[(x + \vartheta \cdot S_T - H)^2\right],$$

where $x$ is the initial endowment and $\vartheta$ belongs to the set of admissible strategies to be described in Section 2.1. Here $\vartheta \cdot S_T$ stands for $\int_0^T \vartheta_t \, dS_t$.

Consider the following model for the stock price $S$ and its volatility process $Y$:

$$\mathcal{L}(S) = (\mu Y^2) \cdot I + Y \cdot W, \tag{1.1}$$

$$Y^2 = Y_0^2 + (\zeta_0 + \zeta_1 Y^2) \cdot I + \sigma Y \cdot \left(\rho W + \sqrt{1 - \rho^2} U\right), \tag{1.2}$$

where $\mathcal{L}$ denotes stochastic logarithm, $W$ and $U$ are independent Brownian motions, $I_t = t$ is the activity process and $\sigma > 0$, $\zeta_0 \geq \sigma^2/2$, $\zeta_1 < 0$, $\mu$, $-1 \leq \rho \leq 1$ are real constants.

Translated into the $dW/dt$ notation the model reads:

$$\frac{dS_t}{S_t} = \mu Y_t^2 \, dt + Y_t \, dW_t,$$

$$dY_t^2 = (\zeta_0 + \zeta_1 Y_t^2) \, dt + \sigma Y_t \left(\rho \, dW_t + \sqrt{1 - \rho^2} \, dU_t\right).$$

The model is set up in such a way that the instantaneous Sharpe ratio equals $\mu Y_t$ and because $Y$ is an autonomous diffusion it follows that the opportunity set (the maximal Sharpe ratio attainable by dynamic trading in the stock from $t$ to maturity) is a deterministic function of $Y_t$. Conditions on $\zeta_0$ and $\zeta_1$ make sure that the volatility process is strictly positive and has a steady state distribution under $P$ (cf. Cox et al. 1985).

We consider information filtration generated by $S$, which in the present model coincides with the filtration generated by $W$ and $U$. In particular, the hedger can back out the current level of volatility from the quadratic variation process of the stock price.

### 1.1. Computation and Verification

We make use of the structural results reported in CK07. There is an opportunity process $L$ and a portfolio process $a$ (called an adjustment process) that solve the optimal investment problem in the absence of the contingent claim. The opportunity process has a natural interpretation in that $L_t^{-1} - 1$ equals the square of the maximal Sharpe ratio attainable by dynamic trading in asset $S$ from $t$ to maturity (cf. CK07, proposition 3.6). $L$ is a deterministic process when the instantaneous Sharpe ratio is deterministic (cf. CK07, proposition 3.28).

In general, process $L$ defines the so-called opportunity-neutral measure (a non-martingale equivalent measure) $\tilde{P}$, which neutralizes the effect of the stochastic opportunity set in the sense that the dynamically optimal strategy under $\tilde{P}$ can be computed as the myopically optimal portfolio under $\tilde{P}$ (cf. CK07, corollary 3.20). In addition, the variance-optimal measure $\tilde{Q}$ can be computed as the minimal martingale measure relative to $\tilde{P}$ (cf. CK07, lemma 3.23). Optimality of the opportunity process $L$ requires that the expected growth rate of $L$ under measure $\tilde{P}$ equals the squared instantaneous Sharpe ratio of the risky asset(s) under $\tilde{P}$ (cf. CK07, lemma 3.19).

Since $Y^2$ is an autonomous affine process and it is the only driver of the instantaneous Sharpe ratio we guess a candidate opportunity process in the exponential affine form:

$$L = \exp(\kappa_0 + \kappa_1 Y^2), \tag{1.3}$$

where $\kappa_0$ and $\kappa_1$ are deterministic functions of time to maturity such that $L_T = 1$. For this functional form of $L$ we write down the optimality criterion described above, which yields a Riccati equation for $\kappa_1$ and a first order linear equation for $\kappa_0$ that are readily solved. With $\tilde{P}$ in hand we evaluate a candidate adjustment process $a$ as the myopic mean-variance stock portfolio weight under $\tilde{P}$:

$$a = b^S / c^S = (\mu + \kappa_1 \sigma \rho) / S_t,$$

where $b^S$ represents the drift of the stock price under measure $\tilde{P}$ and $\sqrt{c^S}$ represents its volatility under $\tilde{P}$ (and hence also under $P$).

The computational procedure described above provides an alternative to the use of so-called fundamental representation equations proposed in Biagini et al. (2000) and Hobson (2004). The advantage of our method stems from the fact that it is readily extended to discontinuous price processes, that it does not require martingale representation assumptions, and that it offers a natural economic interpretation of all computed quantities.

It still has to be verified that the obtained candidates coincide with the true opportunity and adjustment processes. Specifically, we must show that the candidate adjustment process $a$ corresponds to an admissible trading strategy. To this end we first prove that $L\mathcal{E}(-a \cdot S)$ and $L(\mathcal{E}(-a \cdot S))^2$ are martingales, which means that the candidate variance-optimal martingale measure $\tilde{Q}$,

$$\frac{d\tilde{Q}}{dP} = \frac{\mathcal{E}(-a \cdot S)_T}{L_0}, \tag{1.4}$$

is a martingale measure with square integrable density. This, however, does not yet imply that $\tilde{Q}$ is the true VOMM. Merely, we have now constructed an equivalent martingale measure required by assumption 2.1 in CK07.

In the final step of the verification (this step is left out in the theoretical characterization of Hobson 2004) we show that the wealth process $\mathcal{E}(-a \cdot S)$ is generated by an admissible strategy. This is essentially equivalent to demonstrating that $\mathcal{E}(-a \cdot S)$ is a true martingale under all equivalent martingale measures $Q$ such that $E((dQ/dP)^2) < \infty$. We use Novikov's condition combined with Hölder's inequality to show that $E(e^{((\mu + \kappa_1 \sigma \rho)Y)^2 \cdot I_T}) < \infty$ is a sufficient condition for $a$ to be admissible. We then apply the characterization of regular affine processes provided in Duffie et al. (2003, henceforth DFS03), to compute an upper bound of $E(e^{((\mu + \kappa_1 \sigma \rho)Y)^2 \cdot I_T})$ and hence characterize a subset of time horizons $T$ for which $a$ and $L$ described above represent the true solution, and for which $\tilde{Q}$ computed in (1.4) is the true VOMM.

Once we have the true opportunity and adjustment process, the rest of our analysis is a straightforward application of results in CK07. The optimal hedge of the contingent claim $H$ is given by the Föllmer-Schweizer decomposition of $H$ under measure $\tilde{P}$ (cf. lemma 4.8 in CK07). First we compute the mean value process $V$ as a conditional expectation of $H$ under the variance-optimal measure $\tilde{Q}$, cf. CK07 (4.1). $V$ happens to be a deterministic function of 3 state variables, $S$, $Y^2$, and $I$. The optimal hedge $\varphi = \varphi(x, H)$ is then given by:

$$\varphi(x, H) = \xi + a(V - x - \varphi(x, H) \cdot S),$$
$$\xi := c^{VS} / c^S,$$

where $x$ is the initial capital, $c^{VS}$ represents the instantaneous covariance between $V$ and $S$ and $c^S$ stands for the instantaneous variance of $S$. The minimal squared hedging error equals:

$$E\left[(x + \varphi(x, H) \cdot S_T - H)^2\right] = L_0(x - V_0)^2 + \varepsilon_0^2,$$

$$\varepsilon_0^2 := E\left[(L(c^V - (c^{VS})^2 / c^S)) \cdot I_T\right],$$

where $c^V$ stands for the instantaneous variance of $V$, cf. CK07 theorem 4.12.

### 1.2. Interpretation

By CK07, lemmas 3.1 and 3.7, we have that

$$\varphi^S := \varphi(1, 2) = a\mathcal{E}(-a \cdot S) = a(2 - (1 + \varphi^S \cdot S)) \tag{1.5}$$

is a mean-variance efficient strategy for an agent wishing to maximize the unconditional Sharpe ratio of her terminal wealth. The maximal squared Sharpe ratio equals:

$$\text{SR}_S^2 = 1/L_0 - 1 = e^{-\kappa_0(0) - \kappa_1(0)Y_0^2} - 1,$$

where $\kappa_0$, $\kappa_1$ are nonpositive functions of time to maturity computed in Section 3. Thus, in this model, higher volatility means more lucrative dynamic stock investment opportunity.

The optimal stock trading strategy $\varphi^S$ can be interpreted as a solution to quadratic utility maximization with bliss point at 2 and initial wealth level at 1. At an intermediate point in time the distance of agent's wealth from the bliss point is $2 - (1 + \varphi^S \cdot S)$, which is exactly equal to $\mathcal{E}(-a \cdot S)$. In view of (1.5) we observe that the agent becomes more risk averse as her wealth approaches the bliss point. Vice versa, when the risky investment performs poorly the gap between agent's wealth and the bliss point widens and the agent increases her risky position in direct proportion to the gap size. (The optimal dynamic investment clearly has an element of a doubling strategy and this is why it is important to check admissibility of a candidate solution for $a$.) One can view (1.5) as a dynamic portfolio insurance strategy (cf. Black and Jones 1987) in reverse, whereby the investor specifies a fixed ceiling rather than a floor for wealth and uses a state-dependent multiplier $a$.

We next examine the impact of the stochastic opportunity set on $a$. When there is no correlation between stock returns and the volatility we have:

$$a := \frac{b^S}{c^S} = \frac{\tilde{b}^S}{c^S} = \frac{\mu}{S},$$

which interestingly means that the investor acts as if the opportunity set were deterministic (or at least predictable, in the sense of $L$ being a predictable process of finite variation) even though this is clearly not the case and $\tilde{P} \neq P$, cf. CK07 proposition 3.28. Empirical research on equity data finds negative correlation (so called leverage effect) implying that the optimal value of $a$ should be revised upwards by the factor $\kappa_1 \sigma \rho / S$ relative to the uncorrelated case (cf. equation (3.3)).

The mean value process is a sufficiently smooth function of three state variables:

$$V_t = f(T - t, Y_t^2, S_t).$$

It represents a price at which an agent holding dynamically efficient portfolio of equities would not wish to buy or sell the option. The optimal hedge $\varphi(x, H)$ consists of two components—the pure hedge $\xi$ and a feedback element $a(V - x - \varphi \cdot S)$. The quantity $(V - x - \varphi \cdot S)$ represents the shortfall of the hedging portfolio relative to the mean value of the derivative asset. Since $a$ is typically positive the optimal strategy tends to overhedge when it is performing poorly and underhedge once it has accumulated a hedging surplus.

The pure hedging coefficient satisfies:

$$\xi_t = \frac{c_t^{VS}}{c_t^S} = \frac{\partial f}{\partial x_3}(T - t, Y_t^2, S_t) + \rho\sigma \frac{\partial f}{\partial x_2}(T - t, Y_t^2, S_t) S_t.$$

The pure hedge therefore has two components: the standard delta hedge using the representative agent price $V_t$, and a leverage component exploiting the correlation of the representative agent price with the volatility process.

To appreciate the role of the minimal expected squared hedging error $\varepsilon_0^2$ suppose now that in addition to the optimal equity investment the agent is able to sell (issue) an equity option with payoff $H$ at time $T$ at initial price $C_0 > V_0$ (when $C_0 < V_0$ it is optimal to buy the option). Suppose that the initial option position is held to maturity and the agent does not trade in any other options, but she is allowed to engage in additional stock trades for hedging purposes. We show in Lemma 5.1 that in order to maximize her Sharpe ratio the agent should sell $\eta = \frac{C_0 - V_0}{\varepsilon_0^2} \frac{1}{1 + \text{SR}_{S,H}^2}$ options and hedge them optimally to maturity using the strategy:

$$\varphi^H := \varphi(\eta C_0, \eta H) = \eta\xi + a(\eta V - \eta C_0 - \varphi^H \cdot S). \tag{1.6}$$

The unconditional maximal squared Sharpe ratio of the combined strategy $\varphi^S + \varphi^H$ equals:

$$\text{SR}_{S,H}^2 := \text{SR}_S^2 + \frac{(C_0 - V_0)^2}{\varepsilon_0^2},$$

which means that $\frac{C_0 - V_0}{\varepsilon_0}$ is an incremental Sharpe ratio generated by trading in the option. Based on this observation we conclude that when $\varepsilon_0$ is very high one may observe a significant deviation of the market price $C_0$ from the representative agent price $V_0$, which does not give rise to excessively attractive investment opportunities, beyond the ones that already existed in the market before the option was introduced. One can invert the relationship between the unconditional incremental Sharpe ratio and the selling (buying) price to compute unconditional good-deal price bounds (cf. Černý and Hodges 2002).

### 1.3. Organization

In Section 2, we define the admissible trading strategies. In Section 3, we compute the candidate adjustment and opportunity processes and characterize a time horizon $\tilde{T}$ such that the candidate processes represent the true solution for all $T < \tilde{T}$. In Section 4, we give an explicit formula for the mean value process and the pure hedge. Section 5 concludes by giving an explicit formula for the unconditional expected squared hedging error and the incremental Sharpe ratio of an optimally hedged position.

---

## 2. Preliminaries

### 2.1. Trading Strategies and Martingale Measures

We work on a filtered probability space $(\Omega, \mathcal{F}_T, \mathbb{F} = (\mathcal{F}_t)_{t \in [0,T]}, P)$ where $T$ is a fixed time horizon. In this subsection, and in this subsection only, $S$ represents a general semimartingale.

**Definition 2.1** (Delbaen and Schachermayer 1996). A semimartingale $S$ is *locally in $L^2(P)$* if there is a localizing sequence of stopping times $\{U_n\}_{n \in \mathbb{N}}$ such that

$$\sup\left\{E[S_\tau^2] : \tau \leq U_n \text{ stopping time}\right\} < \infty$$

for any $n \in \mathbb{N}$.

**Remark 2.1.** Every continuous semimartingale is locally in $L^2(P)$ since we may take

$$U_n := \inf\{\tau : S_\tau^2 \geq n\}$$

as the sequence of localizing times.

**Definition 2.2.** Consider a price process $S$ locally in $L^2(P)$ with the corresponding localizing sequence $\{U_n\}_{n \in \mathbb{N}}$. A trading strategy $\vartheta$ is called *simple* if it is a linear combination of strategies $Y \mathbf{1}_{]]\tau_1, \tau_2]]}$ where $\tau_1 \leq \tau_2$ are stopping times dominated by $U_n$ for some $n \in \mathbb{N}$ and $Y$ is a bounded $\mathcal{F}_{\tau_1}$-measurable random variable. We denote by $\Theta(S)$ the set of all simple trading strategies.

**Definition 2.3.** For a price process $S$ locally in $L^2(P)$ a trading strategy $\vartheta \in L(S)$ is called *admissible* if there is a sequence $\{\vartheta^{(n)}\}_{n \in \mathbb{N}}$ of simple strategies such that:
- $\vartheta^{(n)} \cdot S_t \to \vartheta \cdot S_t$ in probability for any $t \in [0, T]$; and
- $\vartheta^{(n)} \cdot S_T \to \vartheta \cdot S_T$ in $L^2(P)$.

We denote the set of all admissible strategies by $\bar{\Theta}(S)$.

**Remark 2.2.** The set $\bar{\Theta}(S)$ does not depend on the choice of the localizing sequence $\{U_n\}_{n \in \mathbb{N}}$ in Definition 2.2 (cf. CK07, remark 2.8).

The following lemma shows admissible strategies are economically indistinguishable from simple strategies.

**Lemma 2.1.** For $S$ locally in $L^2(P)$ we have

$$\bar{K}^2 := \overline{\{\vartheta \cdot S_T : \vartheta \in \Theta(S)\}} = \{\vartheta \cdot S_T : \vartheta \in \bar{\Theta}(S)\},$$

where $\overline{\{\cdot\}}$ denotes closure in $L^2(P)$.

*Proof.* See CK07, corollary 2.9.

We now state a result on the duality between admissible strategies and a suitably chosen class of martingale measures for continuous semimartingales.

**Definition 2.4.** Consider a semimartingale $S$ and denote by $\mathcal{M}_2^e(S)$ the subset of equivalent martingale measures with square integrable density, i.e.,

$$\mathcal{M}_2^e(S) := \{Q \sim P : dQ/dP \in L^2(P), \, S \text{ is a } Q\text{-local martingale}\}.$$

**Theorem 2.1.** Let $S$ be a continuous semimartingale with nonempty $\mathcal{M}_2^e(S)$. Then the following assertions are equivalent:

1. $\vartheta \in \bar{\Theta}(S)$
2. $\vartheta \in L(S)$, $\vartheta \cdot S_T \in L^2(P)$ and $\vartheta \cdot S$ is a $Q$-martingale for every $Q \in \mathcal{M}_2^e(S)$.

*Proof.* $(1) \Rightarrow (2)$: This is shown in CK07, corollary 2.5.

$(2) \Rightarrow (1)$: By Delbaen and Schachermayer (1996), theorems 1.2 and 2.2, we have $\vartheta \cdot S_T \in K^2$. Since martingales are determined by their final value, the claim follows.

Theorem 2.1 shows that for continuous processes $\bar{\Theta}(S)$ coincides with the class of trading strategies used in Gourieroux et al. (1998). For a general result on the duality between the admissible strategies and (signed) martingale measures we refer the reader to CK07, lemma 2.4.

### 2.2. Semimartingale Characteristics

From now on all processes in this paper are continuous semimartingales. For any $\mathbb{R}^n$-valued process $X$ we write $X = X_0 + B^X + M^X$ for the canonical decomposition of $X$ into a predictable process of finite variation and a local martingale under measure $P$, and similarly $X = X_0 + \tilde{B}^X + \tilde{M}^X$ for the decomposition under some $\tilde{P} \sim P$. We set

$$C_{ij}^X := [X_i, X_j],$$

where $X_1, \ldots, X_n$ denote the components of $X$. For continuous processes one always has

$$\langle X_i, X_j \rangle = \langle M_i^X, M_j^X \rangle = \langle X_i, X_j \rangle_{\tilde{P}} = \langle \tilde{M}_i^X, \tilde{M}_j^X \rangle_{\tilde{P}} = C_{ij}^X, \tag{2.1}$$

where the angle brackets $\langle \cdot, \cdot \rangle$, $\langle \cdot, \cdot \rangle_{\tilde{P}}$ stand for predictable quadratic covariation under $P$ and $\tilde{P}$, respectively.

By Jacod and Shiryaev (2003, II.2.9) there is an increasing predictable process $A$, a $\mathbb{R}^n$-valued predictable process $b^X$ and $\mathbb{R}^{n \times n}$-valued predictable process $c^X$ whose values are symmetric, nonnegative definite matrices such that

$$B^X = b^X \cdot A, \quad C^X = c^X \cdot A.$$

We write interchangeably $c^{X_i X_j} := c_{ij}^X$, $c^{X_i} := c_{ii}^X$.

In this paper the activity process $A$ can be chosen such that $A_t = I_t := t$ and we adopt this convention henceforth. Thus in this paper $b^X$ refers to the drift and $\sqrt{c^X}$ to the volatility when $X$ is a univariate process. For example, for $X = (Y^2, S)$ in (1.1) and (1.2) we have:

$$\begin{pmatrix} b^{Y^2} \\ b^S \end{pmatrix} = \begin{pmatrix} \zeta_0 + \zeta_1 Y^2 \\ \mu S Y^2 \end{pmatrix}, \tag{2.2}$$

$$\begin{pmatrix} c^{Y^2} & c^{Y^2 S} \\ c^{S Y^2} & c^S \end{pmatrix} = \begin{pmatrix} \sigma^2 Y^2 & \rho\sigma S Y^2 \\ \rho\sigma S Y^2 & S^2 Y^2 \end{pmatrix}. \tag{2.3}$$

Let $f: \mathbb{R}^n \to \mathbb{R}$ be in $C^2$ and denote by $f_i := \frac{\partial f}{\partial x_i}$, $f_{ij} := \frac{\partial^2 f}{\partial x_i \partial x_j}$ its derivatives. Consider an $\mathbb{R}^n$-valued semimartingale $X$. Then $f(X)$ is a semimartingale and the Itô formula in our notation reads:

$$b^{f(X)} = \sum_{i=1}^n f_i(X) b_i^X + \frac{1}{2} \sum_{i,j=1}^n f_{ij}(X) c_{ij}^X, \tag{2.4}$$

$$c^{f(X)} = \sum_{i,j=1}^n f_i(X) f_j(X) c_{ij}^X, \tag{2.5}$$

$$c^{f(X) X_i} = \sum_{j=1}^n f_j(X) c_{ij}^X. \tag{2.6}$$

For a univariate process $N$ its stochastic exponential is given by $\mathcal{E}(N) = e^{N - \frac{1}{2}[N,N]}$. Conversely, for a positive process $L$ its stochastic logarithm equals $\mathcal{L}(L) = \ln L - \ln L_0 + \frac{1}{2}[\ln L, \ln L]$. In terms of characteristics:

$$b^{\mathcal{E}(N)} = \mathcal{E}(N) b^N, \quad c^{\mathcal{E}(N)} = (\mathcal{E}(N))^2 c^N,$$

$$b^{\mathcal{L}(L)} = L^{-1} b^L, \quad c^{\mathcal{L}(L)} = L^{-2} c^L.$$

Suppose $\mathcal{E}(\eta \cdot M^X)$ is a martingale and define a new measure,

$$d\tilde{P} := \mathcal{E}(\eta \cdot M^X)_T \, dP. \tag{2.7}$$

Girsanov theorem (cf. Jacod and Shiryaev 2003, III.3.11 and Kallsen 2006, proposition 2.6) then yields characteristics $\tilde{b}^X$ and $\tilde{c}^X$ under $\tilde{P}$ as follows:

$$\tilde{b}^X = b^X + c^X \eta, \tag{2.8}$$

$$\tilde{c}^X = c^X. \tag{2.9}$$

---

## 3. The Merton Problem

From now on we consider the stock price process $S$ given in equations (1.1) and (1.2) and filtration $\mathbb{F}$ generated by the two uncorrelated Brownian motions $U$ and $W$ specified therein. Admissible trading strategies belong to the set $\bar{\Theta}(S)$ described in Theorem 2.1.

In this section, we identify the opportunity process $L$ and the adjustment process $a$ that characterize the dynamically optimal investment in the underlying asset and the bank account, as discussed in Section 1.2. This type of dynamic asset allocation is generically referred to as the Merton problem.

**Definition 3.1.** We say that $L$ is a *candidate opportunity process* if:

1. $L$ is a $(0, 1]$-valued continuous semimartingale,
2. $L_T = 1$,
3. For $K := \mathcal{L}(L)$ we have

$$b^K = (b^S + c^{KS})^2 / c^S. \tag{3.1}$$

In such case we call $a = (b^S + c^{KS}) / c^S$ the *candidate adjustment process* corresponding to $L$.

The computation of the opportunity process is a key step in the present approach. Recall from the introduction that $L_t$ is closely related to the maximal Sharpe ratio from dynamic trading between $t$ and $T$. The process $Y^2$ is Markov. Moreover, for $t \leq u \leq T$ the distribution of the stock return $S_u / S_t$ conditional on $\mathcal{F}_t$ is a function of $Y_t$ and $u - t$ only. Consequently, it is natural to assume $L_t = f(t, Y_t^2)$ with some function $f$. Why should $f$ be of exponentially affine form as in (1.3)? Naively, the exponential function comes to mind because $L > 0$, $L_T = 1$. The affine exponent is the simplest conceivable one and hence worth trying.

Less naively, one may apply Itô's formula to $L_t = f(t, Y_t^2)$ and equate both sides of (3.1). This leads to a specific partial differential equation for $f$, where an exponential affine form seems appropriate from experience with affine interest rate models.

**Proposition 3.1.** Set

$$A = -\mu^2, \quad B = \zeta_1 - 2\rho\sigma\mu, \quad C = \frac{1}{2}\sigma^2(1 - 2\rho^2), \quad F = \zeta_0,$$

$$y_0 = w_0 = 0,$$

and for functions $w$, $y$ and parameter $\tau' = \tau'(A, B, C, w_0)$ of Lemma A.1 set

$$\kappa_1(t) := w(T - t), \quad \kappa_0(t) := y(T - t), \quad T' := \tau'.$$

Define

$$L_t = \exp(\kappa_0(t) + Y_t^2 \kappa_1(t)), \tag{3.2}$$

$$a_t = (\mu + \rho\sigma\kappa_1(t)) / S_t. \tag{3.3}$$

Then $L$ is a candidate opportunity process and $a$ is the corresponding candidate adjustment process for $T < T'$.

*Proof.* The proof proceeds in two steps, (i) computation and (ii) verification.

**(i)** Consider $L$ in the form (3.2) for as yet unknown functions of calendar time $\kappa_0$ and $\kappa_1$, and define $K := \mathcal{L}(L)$. The Itô formula yields:

$$K := \mathcal{L}(L) = \left(\kappa_0' + Y^2 \kappa_1' + \frac{1}{2}\sigma^2 Y^2 \kappa_1^2\right) \cdot I + \kappa_1 \cdot Y^2$$

$$= \left(\kappa_0' + Y^2 \kappa_1' + \frac{1}{2}\sigma^2 Y^2 \kappa_1^2 + (\zeta_0 + \zeta_1 Y^2)\kappa_1\right) \cdot I + (\kappa_1 \sigma Y) \cdot \left(\rho W + \sqrt{1 - \rho^2} U\right),$$

which in terms of characteristics means:

$$b^K = L^{-1} b^L = \kappa_0' + Y^2 \kappa_1' + \frac{1}{2}\sigma^2 Y^2 \kappa_1^2 + (\zeta_0 + \zeta_1 Y^2)\kappa_1, \tag{3.4}$$

$$c^K = L^{-2} c^L = (\sigma Y \kappa_1)^2, \tag{3.5}$$

$$c^{KS} = \rho\sqrt{c^K c^S} = \rho\sigma S Y^2 \kappa_1,$$

$$c^{KY^2} = \sqrt{c^K c^{Y^2}} = (\sigma Y)^2 \kappa_1.$$

Substitute from (2.2), (2.3), (3.4), and (3.5) into the local optimality condition (3.1). On collecting powers of $Y$ we obtain:

$$-\kappa_0'(t) = \zeta_0 \kappa_1(t),$$

$$-\kappa_1'(t) = -\mu^2 + (\zeta_1 - 2\rho\sigma\mu)\kappa_1(t) + \frac{1}{2}\sigma^2(1 - 2\rho^2)\kappa_1^2(t),$$

with terminal conditions $\kappa_0(T) = \kappa_1(T) = 0$ implied from $L_T = 1$. The solution for $\kappa_0$, $\kappa_1$ is obtained from Lemma A.1 in the manner indicated above.

**(ii)** We have $\kappa_0(t) \leq 0$, $\kappa_1(t) \leq 0$, for all $t \in [0, T]$, $T < T'$ hence $L \in (0, 1]$. Since $\kappa_0$ and $\kappa_1$ are continuous and of finite variation $L$ in (3.2) is a continuous semimartingale. By construction of $\kappa_0$, $\kappa_1$ equation (3.1) holds. Therefore $L$ is a candidate opportunity process and

$$a = \frac{b^S + c^{KS}}{c^S} = (\mu + \rho\sigma\kappa_1) / S \tag{3.6}$$

is the corresponding candidate adjustment process.

---

Since $0 < L \leq 1$ and (3.1) holds the process

$$Z := \frac{L}{L_0} \exp(-b^K \cdot I) = \mathcal{E}(M^K) = \mathcal{E}\left((\kappa_1 \sigma Y) \cdot \left(\rho W + \sqrt{1 - \rho^2} U\right)\right)$$

is a bounded positive martingale and by virtue of Girsanov's theorem:

$$\tilde{W} := -(\kappa_1 \sigma \rho Y) \cdot I + W, \tag{3.7}$$

$$\tilde{U} := -\left(\kappa_1 \sigma \sqrt{1 - \rho^2} Y\right) \cdot I + U, \tag{3.8}$$

are Brownian motions under $\tilde{P}$ with $d\tilde{P}/dP = Z_T$. In view of (1.1), (1.2), (3.7), and (3.8) the $\tilde{P}$-dynamics of $S$ and $Y$ read:

$$\mathcal{L}(S) = (\mu + \kappa_1 \sigma \rho) Y^2 \cdot I + Y \cdot \tilde{W}, \tag{3.9}$$

$$Y^2 = Y_0^2 + (\zeta_0 + \tilde{\zeta}_1 Y^2) \cdot I + \sigma Y \cdot \left(\rho \tilde{W} + \sqrt{1 - \rho^2} \tilde{U}\right), \tag{3.10}$$

$$\tilde{\zeta}_1 := \zeta_1 + \sigma^2 \kappa_1 \tag{3.11}$$

and we have:

$$a = \tilde{b}^S / c^S = (\mu + \kappa_1 \sigma \rho) / S.$$

To be fully in the setup of CK07 we have to verify that the price process $S$ admits an equivalent martingale measure with square integrable density. The following lemma shows that the candidate variance-optimal measure (see equation (1.4)) has the desired property.

**Lemma 3.1.** For $a$, $L$ and $T < T'$ in Proposition 3.1 define

$$\hat{Z} := L\mathcal{E}(-a \cdot S) / L_0.$$

Then:

1. the local martingale $\hat{Z}$ is a martingale,
2. the measure $\tilde{Q}$, $d\tilde{Q} = \hat{Z}_T \, dP$, is an equivalent martingale measure,
3. the local martingale $L(\mathcal{E}(-a \cdot S))^2 / L_0$ is a martingale and therefore $\tilde{Q} \in \mathcal{M}_2^e(S)$.

*Proof.* One can write

$$\hat{Z} = \mathcal{E}(K - a \cdot S - a \cdot [K, S]) = \mathcal{E}(M^K - a \cdot M^S + (b^K - a(b^S + c^{KS})) \cdot I) = \mathcal{E}(M^K - a \cdot M^S),$$

the last equality a consequence of the local optimality criterion (3.1). Thus $\hat{Z}$ is a local martingale and by Section 5 in Hobson (2004) also a true martingale. Let $b_{\tilde{Q}}^S$ denote the drift of $S$ under measure $\tilde{Q}$, then by Girsanov's theorem (2.7, 2.8):

$$b_{\tilde{Q}}^S = b^S + c^{KS} - ac^S = 0,$$

where the final equality follows from the definition of $a$, equation (3.6). Consequently, $\tilde{Q}$ is an equivalent martingale measure and $\mathcal{E}(-a \cdot S)$ is a local $\tilde{Q}$-martingale. It follows (cf. Jacod and Shiryaev 2003, III. 3.8) that $\hat{Z}\mathcal{E}(-a \cdot S) = L(\mathcal{E}(-a \cdot S))^2 / L_0$ is a local martingale and by Section 5 in Hobson (2004) it is a true martingale.

**Remark 3.1.** Under conditions (1)–(3) in Lemma 3.1 Hobson (2004) conjectures that $\tilde{Q}$ is the true VOMM. The validity of such a statement is not obvious in general (cf. Černý and Kallsen 2006). While $\tilde{Q}$ may be the true VOMM in the present model for any $T < T'$ we are not aware of any proof to that effect. In general, to conclude that the candidate measure $\tilde{Q}$ is the true VOMM one has to show that $\mathcal{E}(-a \cdot S)$ is a $Q$-martingale for all $Q \in \mathcal{M}_2^e(S)$. In the sequel we are able to prove that $\tilde{Q}$ is the true VOMM for sufficiently small $T$.

**Proposition 3.2.** Take $T < T'$ in the notation of Proposition 3.1. If

$$E\left[e^{[a \cdot S, a \cdot S]_T}\right] < \infty$$

then $L$ and $a$ in Proposition 3.1 are the true opportunity process and adjustment process, respectively, in the sense of CK07, definitions 3.3 and 3.8. Consequently, $\tilde{Q}$ defined in Lemma 3.1 (2) is the VOMM.

*Proof.*

**Step 1:** We show that $\mathcal{E}((-a\mathbf{1}_{]]\tau,T]]}) \cdot S) L$ is of class (D) for any stopping time $\tau$. Fix a stopping time $\tau$ and set

$$N := K - a \cdot S - [K, a \cdot S].$$

Lemma 3.1 shows that $\hat{Z} = \mathcal{E}(-a \cdot S) L / L_0 = \mathcal{E}(N)$ is a positive martingale. Then

$$\hat{Z} / \hat{Z}_\tau = \mathcal{E}(N) / \mathcal{E}(N_\tau) = \mathcal{E}(N - N_\tau)$$

is a positive local martingale and therefore a supermartingale. Since

$$E((\hat{Z} / \hat{Z}_\tau)_T) = E(E(\hat{Z}_T / \hat{Z}_\tau | \mathcal{F}_\tau)) = E(E(\hat{Z}_T | \mathcal{F}_\tau) / \hat{Z}_\tau) = E(\hat{Z}_\tau / \hat{Z}_\tau) = 1 = (\hat{Z} / \hat{Z}_\tau)_0$$

$\hat{Z} / \hat{Z}_\tau$ is actually a true martingale and hence of class (D). Since $L$ is bounded

$$\mathcal{E}((-a\mathbf{1}_{]]\tau,T]]}) \cdot S) L = L_\tau \hat{Z} / \hat{Z}_\tau$$

is of class (D) as well.

**Step 2:** We show that $\lambda := a\mathbf{1}_{]]\tau,T]]} \mathcal{E}((-a\mathbf{1}_{]]\tau,T]]}) \cdot S)$ is an admissible trading strategy for any stopping time $\tau$. Consider a measure $Q \in \mathcal{M}_2^e(S)$. By Hölder's inequality and hypothesis we have

$$E_Q\left[e^{\frac{1}{2}[(a\mathbf{1}_{]]\tau,T]]}) \cdot S, (a\mathbf{1}_{]]\tau,T]]}) \cdot S]_T}\right] \leq \sqrt{E((dQ/dP)^2) E[e^{[a \cdot S, a \cdot S]_T}]} < \infty,$$

whereby Novikov's condition implies that $\mathcal{E}(-(a\mathbf{1}_{]]\tau,T]]}) \cdot S)$ is a $Q$-martingale for any $Q \in \mathcal{M}_2^e(S)$. Noting that $1 - \lambda \cdot S = \mathcal{E}((-a\mathbf{1}_{]]\tau,T]]}) \cdot S)$ we conclude that $E_Q(\lambda \cdot S_T) = 0$ for all $Q \in \mathcal{M}_2^e(S)$. By virtue of Lemma 3.1 (1,3) we have

$$E[(\lambda \cdot S_T)^2] = E\left[\left(1 - \frac{\mathcal{E}(-a \cdot S)_T}{\mathcal{E}(-a \cdot S)_\tau}\right)^2 \bigg| \mathcal{F}_\tau\right] = E(1 - L_\tau) < 1,$$

implying $\lambda \cdot S_T \in L^2(P)$. Theorem 2.1 yields $\lambda \in \bar{\Theta}(S)$.

**Step 3:** We have shown in Proposition 3.1 that conditions 1, 2, and 3 of CK07, theorem 3.25 are satisfied. Steps 1 and 2 of this proof show that condition 4 (CK07, equations (3.33), (3.34)) is satisfied, too. Hence $a$ and $L$ represent the true adjustment and opportunity process, respectively. Proposition 3.13 in CK07 implies that $\hat{Z}$ is the density of the variance-optimal martingale measure.

**Remark 3.2.** It is likely that the condition $E(e^{[a \cdot S, a \cdot S]_T}) < \infty$ is far from necessary since the proof is based on Hölder's inequality and subsequent application of Novikov's condition. It is an open question whether one can prove weaker sufficient conditions for admissibility of $a$ and in particular whether $a$ is admissible for all $T < T'$.

**Proposition 3.3.** Consider the function $\kappa_1$ and the parameter $T'$ defined in Proposition 3.1. For $T < T'$ define

$$\nu(T) := \max_{t \in [0,T]} (\mu + \sigma\rho\kappa_1(t))^2. \tag{3.12}$$

For $x \in \mathbb{R}^+$ set

$$\tilde{T}(x) := \tau'(x, \zeta_1, \sigma^2/2, 0)$$

where the parameter $\tau' = \tau'(x, \zeta_1, \sigma^2/2, 0) \in \mathbb{R}^+ \cup \{\infty\}$ is defined in Lemma 6.1.

1. If $\tilde{T}(\nu(T)) > T$ then $a$, $L$ in Proposition 3.1 represent the true adjustment and opportunity process, respectively.
2. The condition $\tilde{T}(\nu(T)) > T$ is always satisfied for small enough $T > 0$.

---

## 4. Optimal Hedging

From now on fix a time horizon $T > 0$ such that $\tilde{T}(\nu(T)) > T$. Existence of such a time horizon is guaranteed by Proposition 3.3. Furthermore, we need to make sure that the contingent claim $H$ has a finite second moment under $P$. For technical reasons (cf. Proposition 4.1) we restrict our attention to bounded contingent claims such as European put options. This automatically guarantees $H \in L^2(P)$.

The optimal hedge is given by the Föllmer-Schweizer decomposition of $H$ under measure $\tilde{P}$ as follows. By lemma 3.23 in CK07 the variance-optimal measure $\tilde{Q}$ coincides with the minimal measure relative to $\tilde{P}$ (see also equation (3.9)):

$$\frac{d\tilde{Q}}{d\tilde{P}} = \mathcal{E}(-a \cdot M^S)_T = \mathcal{E}(-(aS) \cdot (Y \cdot \tilde{W}))_T = \mathcal{E}\left(-(\mu + \kappa_1 \sigma\rho) Y \cdot \tilde{W}\right)_T.$$

By virtue of Girsanov's theorem:

$$\hat{W} := ((\mu + \kappa_1 \sigma\rho) Y) \cdot I + \tilde{W},$$
$$\hat{U} := \tilde{U}$$

are uncorrelated Brownian motions under $\tilde{Q}$ and therefore the $\tilde{Q}$-dynamics of $S$ and $Y$ read:

$$\mathcal{L}(S) = Y \cdot \hat{W},$$

$$Y^2 = Y_0^2 + (\zeta_0 + \hat{\zeta}_1 Y^2) \cdot I + \sigma Y \cdot \left(\rho\hat{W} + \sqrt{1 - \rho^2}\hat{U}\right),$$

$$\hat{\zeta}_1 := \zeta_1 - \rho\sigma(\mu + \kappa_1 \sigma\rho) = \zeta_1 - \rho\sigma\mu + \kappa_1 \sigma^2(1 - \rho^2).$$

Define the mean value process $V$:

$$V_t := E_{\tilde{Q}}[H | \mathcal{F}_t].$$

**Proposition 4.1.** If the contingent claim $H$ is given by $g(Y_T^2, S_T)$ where $g$ is a bounded continuous function then $V_t = f(T - t, Y_t^2, S_t)$ for $f \in C^{1,2,2}$ and $f$ is the unique classical solution of the PDE:

$$0 = -f_1 + (\zeta_0 + \hat{\zeta}_1 y) f_2 + \frac{y}{2}\left(\sigma^2 f_{22} + 2\rho\sigma s f_{23} + s^2 f_{33}\right),$$

$$f(0, y, s) = g(y, s),$$

with $f_i := \partial f / \partial x_i$, $f_{ij} := \partial^2 f / (\partial x_i \partial x_j)$.

*Proof.* The proof is given in Heath and Schweizer (2000), Section 2.1 for $\rho = 0$. The reasoning for $\rho \neq 0$ is identical, since in either case $\tilde{Q}$ is equivalent to $P$ and $\hat{\zeta}_1$ is continuously differentiable in time regardless of the value of $\rho$.

Proposition 4.1 together with proposition 4.7 in CK07 and Itô's formula yield an explicit expression for the pure hedge $\xi$:

$$\xi_t := \frac{c_t^{SV}}{c_t^S} = \frac{f_2(T - t, Y_t^2, S_t) c_t^{Y^2 S} + f_3(T - t, Y_t^2, S_t) c_t^S}{c_t^S}$$

$$= f_3(T - t, Y_t^2, S_t) + \rho\sigma f_2(T - t, Y_t^2, S_t) S_t, \tag{4.1}$$

where $f_i(x_1, x_2, \ldots, x_n) := \partial f / \partial x_i$.

**Remark 4.1.** It is possible to provide more explicit expressions for $V$ and $\xi$ subject to technical conditions whose verification we defer to future research. $(Y^2, \ln S)$ form a time-inhomogeneous conservative regular affine process under $\tilde{Q}$, and one can use the characterization of Filipović (2005) to evaluate their joint characteristic function. For $\text{Re } z = 0$ we have:

$$E_{\tilde{Q}}\left[e^{z \ln S_T} \big| \mathcal{F}_t\right] = e^{v_0(t,z) + v_1(t,z) Y_t^2 + z \ln S_t},$$

where both $v_i$ are functions of $t$ and $z$ solving:

$$-\frac{\partial}{\partial t} v_0(t, z) = \zeta_0 v_1(t, z)$$

$$-\frac{\partial}{\partial t} v_1(t, z) = \frac{1}{2}(z^2 - z) + v_1(t, z)\left(\zeta_1 - \sigma\rho(\mu - z) + \sigma^2(1 - \rho^2)\kappa_1(t)\right) + \frac{1}{2}\sigma^2 v_1^2(t, z),$$

$$v_0(T, z) = v_1(T, z) = 0.$$

These Riccati equations are time-dependent and can only be solved numerically. If the $\tilde{Q}$-characteristic function possesses analytic extension for $\text{Re } z > 0$ and subject to further technicalities one obtains:

$$V_t = E_{\tilde{Q}}\left[\int_{\beta - i\infty}^{\beta + i\infty} \pi(z) e^{z \ln S_T} \, dz \bigg| \mathcal{F}_t\right] = \int_{\beta - i\infty}^{\beta + i\infty} \pi(z) e^{v_0(t,z) + v_1(t,z) Y_t^2 + z \ln S_t} \, dz, \tag{4.2}$$

where $\beta \in \mathbb{R}$ is a suitably chosen constant and $\pi(z)$ are the Fourier coefficients of the contingent claim (cf. Černý 2007; Hubalek et al. 2006):

$$H = \int_{\beta - i\infty}^{\beta + i\infty} \pi(z) e^{z \ln S_T} \, dz.$$

For example, a European put option with strike $e^k$ yields $\pi(z) = \frac{e^{k(1-z)}}{2\pi i z(z-1)}$, $\beta < 0$.

Subject to additional conditions one can differentiate under the integral sign in (4.2) and from (4.1) obtain:

$$\xi_t = S_t^{-1} \int_{\beta - i\infty}^{\beta + i\infty} (z + \rho\sigma v_1(t, z)) \pi(z) e^{v_0(t,z) + v_1(t,z) Y_t^2 + z \ln S_t} \, dz. \tag{4.3}$$

---

## 5. Hedging Error

Proposition 4.1, the Itô formula (2.4)–(2.6) and equation (2.3) yield:

$$\gamma_t := c_t^V - \frac{(c_t^{SV})^2}{c_t^S} = (f_2(T - t, Y_t^2, S_t))^2 \sigma^2 Y_t^2 (1 - \rho^2).$$

By theorem 4.12 in CK07 the minimal squared hedging error with initial capital $V_0$ satisfies:

$$\varepsilon_0^2 := E\left[(V_0 + \varphi(V_0, H) \cdot S_T - H)^2\right] = E[(L\gamma) \cdot I_T]$$

$$= \sigma^2(1 - \rho^2) E\left[\int_0^T e^{\kappa_0(t) + \kappa_1(t) Y_t^2} Y_t^2 (f_2(T - t, Y_t^2, S_t))^2 \, dt\right].$$

**Remark 5.1.** Subject to technical conditions (cf. Duffie et al. 2000) one can use the Fourier expression for the mean value process (4.2) together with the "extended" Fourier transform of Duffie et al. (2000) to write:

$$\varepsilon_0^2 = E[(L\gamma) \cdot I_T] = E\left[\int_0^T \gamma_t L_t \, dt\right]$$

$$= (1 - \rho^2)\sigma^2 \int_0^T dt \, e^{\kappa_0(t)} \prod_{i=1}^2 \int dz_i \, v_1(t, z_i) \pi(z_i) e^{u_0(t, z_i)} \cdot \phi(t, \kappa_1(t) + v_1(t, z_1) + v_1(t, z_2), z_1 + z_2) \tag{5.1}$$

where $\phi$ is computed in Appendix B. We leave the detailed analysis of the technical conditions required to make (5.1) rigorous to future research.

We conclude this section by linking the hedging error $\varepsilon_0^2$ to option prices and performance measures. Recall from Section 1.2 that $C_0$ is the price at which the contingent claim with payoff $H$ can be sold at time zero.

**Definition 5.1.** We call

$$\text{SR}_{S,H} := \sup\left\{\frac{E[\vartheta \cdot S_T + \eta(C_0 - H)]}{\sqrt{\text{Var}(\vartheta \cdot S_T + \eta(C_0 - H))}} : \vartheta \in \bar{\Theta}(S), \eta \in \mathbb{R}\right\} \tag{5.2}$$

the *maximal unconditional Sharpe ratio*, where we set $0/0 := 0$.

**Lemma 5.1.** The maximal unconditional Sharpe ratio is given by:

$$\text{SR}_{S,H}^2 = \frac{1}{L_0} - 1 + \frac{(C_0 - V_0)^2}{\varepsilon_0^2}, \tag{5.3}$$

with convention $0/0 = 0$.

*Proof.* Define $X := \vartheta \cdot S_T + \eta(C_0 - H)$. Easily,

$$\text{SR}^2(X) := \frac{(E[X])^2}{\text{Var}(X)} = \frac{1}{\inf_{\alpha \in \mathbb{R}}\{E[(1 - \alpha X)^2]\}} - 1 = \sup_{\alpha \in \mathbb{R}} \frac{1}{E[(1 - \alpha X)^2]} - 1.$$

Then

$$\text{SR}_{S,H}^2 = \sup_{\vartheta \in \bar{\Theta}(S), \eta \in \mathbb{R}} \{\text{SR}^2(X)\} = \sup_{\alpha \in \mathbb{R}, \vartheta \in \bar{\Theta}(S), \eta \in \mathbb{R}} \frac{1}{E[(1 - \alpha X)^2]} - 1$$

$$= \frac{1}{\inf_{\vartheta \in \bar{\Theta}(S), \eta \in \mathbb{R}}\{E[(1 - X)^2]\}} - 1 = \frac{1}{\inf_{\eta \in \mathbb{R}} \inf_{\vartheta \in \bar{\Theta}(S)}\{E[(1 - X)^2]\}} - 1$$

$$= \inf_{\eta \in \mathbb{R}} \frac{1}{L_0(1 - \eta(C_0 - V_0))^2 + \eta^2 \varepsilon_0^2} - 1,$$

where the last equality follows from CK07 theorem 4.12 with contingent claim $1 - \eta(H - C_0)$. By CK07 theorem 4.10 with contingent claim $1 - \eta(H - C_0)$ the optimal investment cum hedging strategy is given by $\varphi^S + \varphi^H$ (see equations (1.5) and (1.6)). Straightforward calculations yield the optimal number of shares and the maximal Sharpe ratio:

$$\eta = \frac{C_0 - V_0}{\varepsilon_0^2} \frac{1}{1 + \text{SR}_{S,H}^2},$$

$$\text{SR}_{S,H}^2 = 1/L_0 - 1 + (C_0 - V_0)^2 / \varepsilon_0^2.$$

---

## Appendix A

**Lemma A.1.** Consider the following system of ordinary differential equations for $\tau \geq 0$, $A, B, C, F, w_0, y_0 \in \mathbb{C}$:

$$w'(\tau) = A + Bw(\tau) + Cw^2(\tau), \tag{A.1}$$

$$w(0) = w_0, \tag{A.2}$$

$$y'(\tau) = Fw(\tau), \tag{A.3}$$

$$y(0) = y_0. \tag{A.4}$$

Define

$$\hat{w}_0 := B/2 + Cw_0,$$
$$D := \sqrt{B^2 - 4AC},$$

by taking the principal value of the square root with branch cut along the negative real line. Let

$$\tau' := \tau'(A, B, C, w_0) := \inf\{\tau \geq 0 : w(\tau) \text{ unbounded on } [0, \tau)\}.$$

Then $w$, $y$ given below represent a solution of (A.1)–(A.4) on $[0, \tau')$. Where $w$, $y$ might be multivalued we take the unique version continuous in $\tau$ on $[0, \tau')$ and satisfying the initial conditions.

1. **For $C = 0$, $D \neq 0$:**

$$w = w_0 + \frac{A}{B}(e^{B\tau} - 1),$$

$$y = y_0 + F\left[w_0\tau + \frac{A}{B}\left(\frac{e^{B\tau} - 1}{B} - \tau\right)\right],$$

$$\tau' = +\infty.$$

2. **For $C = 0$, $D = 0$:**

$$w = w_0 + A\tau,$$

$$y = y_0 + F\left(w_0\tau + \frac{A}{2}\tau^2\right),$$

$$\tau' = +\infty.$$

3. **For $C \neq 0$, $D = 0$:**

$$w = C^{-1}\left(\frac{\hat{w}_0}{1 - \hat{w}_0\tau} - \frac{B}{2}\right),$$

$$y = y_0 - \frac{F}{C}\left(\ln(1 - \hat{w}_0\tau) + \frac{B\tau}{2}\right),$$

$$\tau' = +\infty \text{ for } \text{Im}(\hat{w}_0) \neq 0, \text{ or } \hat{w}_0 \leq 0,$$

$$\tau' = 1/\hat{w}_0 \text{ for } \hat{w}_0 > 0.$$

4. **For $C \neq 0$, $D \neq 0$:**

$$w = -\frac{B}{2C} + \frac{D}{2C} \frac{(\hat{w}_0 + D/2)e^{-D\tau/2} + (\hat{w}_0 - D/2)e^{D\tau/2}}{(\hat{w}_0 + D/2)e^{-D\tau/2} - (\hat{w}_0 - D/2)e^{D\tau/2}},$$

$$y = y_0 + F\left(-\frac{B}{2C}\tau - \frac{1}{C}\ln\frac{(\hat{w}_0 + D/2)e^{-D\tau/2} - (\hat{w}_0 - D/2)e^{D\tau/2}}{D}\right),$$

$$\tau' = \inf\left\{\tau \geq 0 : (\hat{w}_0 + D/2)e^{-D\tau/2} - (\hat{w}_0 - D/2)e^{D\tau/2} = 0\right\}.$$

---

## Appendix B

Define $z = (z_1, z_2)$, then DFS03 (see theorem 3.2 in Kallsen (2006) for details) yields that $(Y^2, \ln S)$ is conservative regular affine and therefore for $\text{Re } z_1 \leq 0$, $\text{Re } z_2 = 0$ we have:

$$\psi(z, t) = E\left[e^{z_1 Y_t^2 + z_2 \ln S_t}\right] = e^{v_0(t,z) + v_1(t,z) Y_0^2 + v_2(t,z) \ln S_0},$$

where $v_0$, $v_1$, $v_2$ solve the following system of Riccati equations:

$$\frac{\partial v_2(t, z)}{\partial t} = 0, \tag{B.1}$$

$$\frac{\partial v_0(t, z)}{\partial t} = \zeta_0 v_1(t, z), \tag{B.2}$$

$$\frac{\partial v_1(t, z)}{\partial t} = \frac{1}{2}(z_2^2 + z_2(\mu - \frac{1}{2})) + (\rho\sigma z_2 + \zeta_1)v_1(t, z) + \frac{\sigma^2}{2}v_1^2(t, z), \tag{B.3}$$

$$v_0(0, z) = 0, \quad v_1(0, z) = z_1, \quad v_2(0, z) = z_2. \tag{B.4}$$

Set $A = \frac{1}{2}z_2^2 + z_2(\mu - \frac{1}{2})$, $B = \rho\sigma z_2 + \zeta_1$, $C = \frac{1}{2}\sigma^2$, $F = \zeta_0$ and take $w$, $y$ as in Lemma A.1 with $w_0 = z_1$, $y_0 = 0$. Then the system (B.1–B.4) is solved by $v_0 = y$, $v_1 = w$, $v_2 = z_2$.

Under technical conditions (cf. Duffie et al. 2000) one has:

$$\phi(t, z) := E\left[Y_t^2 e^{z_1 Y_t^2 + z_2 \ln S_t}\right] = E\left[\frac{\partial}{\partial z_1} e^{z_1 Y_t^2 + z_2 \ln S_t}\right]$$

$$= \frac{\partial}{\partial z_1} E\left[e^{z_1 Y_t^2 + z_2 \ln S_t}\right] = \frac{\partial \psi(t, z)}{\partial z_1}$$

$$= e^{v_0(t,z) + v_1(t,z) Y_0^2 + z_2 \ln S_0} \left(\frac{\partial}{\partial z_1} v_0(t, z) + Y_0^2 \frac{\partial}{\partial z_1} v_1(t, z)\right).$$

---

## References

- Biagini, F., P. Guasoni, and M. Pratelli (2000): Mean–Variance Hedging for Stochastic Volatility Models, *Math. Finance* 10(2), 109–123.
- Black, F., and R. Jones (1987): Simplifying Portfolio Insurance, *J. Portfol. Manage.* 14, 48–51.
- Brigo, D., and B. Hanzon (1998): On Some Filtering Problems Arising in Mathematical Finance, *Insurance: Math. Econ.* 22, 53–64.
- Černý, A. (2007): Optimal Continuous-Time Hedging with Leptokurtic Returns, *Math. Finance* 17(2), 175–203.
- Černý, A., and S. D. Hodges (2002): The Theory of Good-Deal Pricing in Financial Markets, in *Mathematical Finance—Bachelier Congress 2000*, H. Geman, D. Madan, S. R. Pliska, and T. Vorst eds., pp. 175–202. Berlin: Springer Verlag.
- Černý, A., and J. Kallsen (2008): A Counterexample Concerning the Variance-Optimal Martingale Measure. *Math. Finance*, 18(2), 305–316.
- Černý, A., and J. Kallsen (2007): On the Structure of General Mean–Variance Hedging Strategies, *Ann. Probab.* 35(5), 1479–1531.
- Cox, J. C., J. E. Ingersoll, and S. A. Ross (1985): An Intertemporal General Equilibrium Model of Asset Prices, *Econometrica* 53, 363–384.
- Delbaen, F., and W. Schachermayer (1996): Attainable Claims with p-th Moments, *Ann. Inst. H. Poincaré Probab. Statist.* 32(6), 743–763.
- Duffie, D., D. Filipović, and W. Schachermayer (2003): Affine Processes and Applications in Finance, *Ann. Appl. Probab.* 13(3), 984–1053.
- Duffie, D., J. Pan, and K. Singleton (2000): Transform Analysis and Asset Pricing for Affine Jump Diffusions, *Econometrica* 68, 1343–1376.
- Filipović, D. (2005): Time-Inhomogeneous Affine Processes, *Stochast. Process. Their Appl.* 115(4), 639–659.
- Gourieroux, C., J. P. Laurent, and H. Pham (1998): Mean–Variance Hedging and Numéraire, *Math. Finance* 8(3), 179–200.
- Heath, D., E. Platen, and M. Schweizer (2001): Comparison of Two Quadratic Approaches to Hedging in Incomplete Markets, *Math. Finance* 11(4), 385–413.
- Heath, D., and M. Schweizer (2000): Martingales versus PDEs in Finance: An Equivalence Result with Examples, *J. Appl. Probab.* 37(4), 947–957.
- Heston, S. (1993): A Closed-form Solution for Options with Stochastic Volatility with Applications to Bond and Currency Options, *Rev. Financial Stud.* 6, 327–344.
- Hobson, D. (2004): Stochastic Volatility Models, Correlation, and the q Optimal Measure, *Math. Finance* 14(4), 537–556.
- Hubalek, F., J. Kallsen, and L. Krawczyk (2006): Variance-Optimal Hedging for Processes with Stationary Independent Increments, *Ann. of Appl. Prob.* 16, 853–885.
- Jacod, J., and A. N. Shiryaev (2003): Limit Theorems for Stochastic Processes, in *Grundlehren der Mathematischen Wissenschaften*, 2nd edn., Vol. 288. Berlin: Springer-Verlag.
- Kallsen, J. (2006): A Didactic Note on Affine Stochastic Volatility Models, in *From Stochastic Calculus to Mathematical Finance: The Shiryaev Festschrift*, Y. Kabanov, R. Liptser, and J. Stoyanov, eds., pp. 343–368. Berlin: Springer Verlag.
- Kim, S., N. Shephard, and S. Chib (1998): Stochastic Volatility: Likelihood Inference and Comparison with ARCH Models, *Rev. Econ. Stud.* 65, 361–393.
- Laurent, J. P., and H. Pham (1999): Dynamic Programming and Mean-variance Hedging, *Finance Stochast.* 3(1), 83–110.
